<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>EVAN VALE ‚Ä¢ Click-to-Order (v2)</title>
  <meta name="theme-color" content="#0a0f0b">
  <style>
    :root{
      --bg:#0a0f0b;--bg2:#0f1a12;--text:#f8fff6;--muted:#cde3cf;--accent:#ffd166;
      --brand:#e53935;--brand2:#36c06b;--panel:#102219;--border:#203326;
      --shadow:0 18px 50px rgba(0,0,0,.5);--r:16px
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,Segoe UI,Prompt,sans-serif;color:var(--text);
      background:radial-gradient(1200px 700px at 0% 0%,#19301f 0,transparent 60%),
                 radial-gradient(1000px 800px at 100% 0%,#2a1a1a 0,transparent 60%),
                 linear-gradient(180deg,var(--bg),var(--bg2));}
    a{color:var(--accent);text-decoration:none}
    .wrap{max-width:1100px;margin:auto;padding:16px}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;
      background:linear-gradient(180deg,#132017,#0e1812);border:1px solid var(--border);
      border-radius:18px;box-shadow:var(--shadow);position:sticky;top:10px;z-index:10}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:40px;height:40px;border-radius:12px;
      background:conic-gradient(from 220deg,#e53935,#36c06b,#ffd166,#e53935);display:grid;place-items:center;
      color:#1b0d0d;font-weight:900}
    .btn{cursor:pointer;border:1px solid var(--border);background:#132319;color:#f2fff2;
      border-radius:12px;padding:9px 12px;font-weight:800}
    .btn.primary{background:linear-gradient(90deg,var(--brand),var(--brand2));border:none;color:#1b0d0d}
    .grid{display:grid;gap:14px}
    .hero{margin-top:14px;display:grid;grid-template-columns:2fr 1fr;gap:14px}
    .glass{background:linear-gradient(180deg,#0f1913cc,#0e1712cc);border:1px solid var(--border);
      border-radius:18px;box-shadow:var(--shadow);padding:16px}
    .section{margin-top:18px}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:#132319;cursor:pointer}
    .tab.active{background:linear-gradient(90deg,var(--brand),var(--brand2));border:none;color:#1b0d0d}
    .pkg{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
    .card{background:#102219;border:1px solid var(--border);border-radius:16px;padding:14px}
    .price{font-weight:900}
    .muted{color:var(--muted)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .input, select, textarea{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);
      background:#0f1a13;color:#fff}
    .summary{position:sticky;top:84px}
    .pill{padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#132319}
    @media (max-width:900px){.hero{grid-template-columns:1fr}.summary{position:static}}
    @media (max-width:520px){.cart-item{grid-template-columns:1fr 64px 64px 84px 28px}}

    /* CART (left sidebar version) */
    .cart{display:grid;gap:8px}
    .cart-item{display:grid;grid-template-columns:1fr 76px 76px 90px 28px;gap:8px;align-items:center;
      border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:8px}
    .del{background:transparent;border:none;color:#ff6b6b;font-size:18px;cursor:pointer}

    /* CART MINI (hero-right like photo #1) */
    #cartCompact{display:grid;gap:8px}
    .cart-mini{
      display:grid;grid-template-columns:1fr 80px 80px 90px 28px;
      gap:8px;align-items:center;
      border:1px solid rgba(255,255,255,.08);
      border-radius:12px;padding:8px
    }
    .cart-mini .left{display:grid;gap:2px}
    .cart-mini input.qty{
      width:100%;padding:8px;border-radius:10px;border:1px solid var(--border);
      background:#0f1a13;color:#fff;text-align:center
    }
    .cart-mini .price,.cart-mini .sub{font-weight:800}
    .cart-mini .del{background:transparent;border:none;color:#ff6b6b;font-size:18px;cursor:pointer}
    @media (max-width:520px){
      .cart-mini{grid-template-columns:1fr 64px 64px 84px 28px}
    }
  </style>
</head>
<body>
<div class="wrap">
  <nav class="nav">
    <div class="brand">
      <div class="logo">EV</div>
      <div>
        <div style="font-weight:900">EVAN VALE</div>
        <div class="muted" style="font-size:12px">Click-to-Order ‚Ä¢ ‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</div>
      </div>
    </div>
    <div class="tools" style="display:flex;gap:8px;flex-wrap:wrap">
      <a class="btn" href="#packages">‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à</a>
      <a class="btn" href="#checkout">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</a>
      <a class="btn" href="#history">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</a>
      <span class="pill">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤: <b id="cartCount">0</b></span>
    </div>
  </nav>

  <section class="hero">
    <div class="glass">
      <h2 style="margin:0">‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à‡∏¢‡∏≠‡∏î‡∏Æ‡∏¥‡∏ï</h2>
      <div class="tabs" id="gameTabs"></div>
      <p class="muted" style="margin:6px 0 10px">‡∏Å‡∏î ‚Äú‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ ‚Äú‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‚Äù</p>
      <div id="pkgGrid" class="pkg"></div>
    </div>

    <!-- HERO RIGHT CART (the compact cart UI) -->
    <aside class="glass summary" id="heroCart">
      <h3 style="margin:0">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</h3>
      <div id="cartCompact"></div>
      <div style="height:1px;background:rgba(255,255,255,.12);margin:8px 0"></div>
      <div class="cart-mini-actions" style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <spa<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<meta name="theme-color" content="#0a0f0b">
<title>EVAN VALE ‚Ä¢ Christmas Event | ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏î‡∏µ ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ ‡∏°‡∏µ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏î‡∏π‡πÅ‡∏•</title>
<meta name="description" content="EVAN VALE Christmas Event ‚Äî ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏î‡∏µ ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡∏°‡∏µ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏î‡∏π‡πÅ‡∏• 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö TrueMoney, PromptPay ‡πÅ‡∏•‡∏∞‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£" />
<style>
/* ===== MOBILE ===== */
@media (max-width:480px){
  .wrap{padding:16px}
  .nav{gap:10px;padding:12px}
  .nav .tools{width:100%;display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .nav .tools .btn{width:100%;min-height:44px;display:flex;align-items:center;justify-content:center}
  .nav .tools .btn.primary{grid-column:1/-1}
  .hero{grid-template-columns:1fr;gap:14px}
  .grid.two{grid-template-columns:1fr}
  .tabs{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .tab{width:100%;text-align:center}
  .grid.pkg{grid-template-columns:repeat(2,minmax(0,1fr))}
  .grid.pkg .glass{display:grid;align-content:start;min-height:128px!important}
  .price{font-size:18px}
  .row{grid-template-columns:1fr;gap:10px}
  h1{font-size:22px}
  .nav .tools a[href="#packages"],
  .nav .tools a[href="#order"],
  .nav .tools a[href="#history"]{display:none;}
}
.table-scroll{overflow-x:auto;-webkit-overflow-scrolling:touch}
.table-scroll table{min-width:720px}
/* ===== THEME ===== */
:root{
  --bg:#0a0f0b;--bg2:#0f1a12;--glass:#0e1511cc;--panel:#0f1a12;--card:#101d15;
  --text:#f8fff6;--muted:#cde3cf;--muted2:#b8d2bb;--brand:#e53935;--brand2:#36c06b;
  --accent:#ffd166;--warn:#ff6b6b;--border:#203326;--shadow:0 20px 60px rgba(0,0,0,.55);--radius:18px;
}
*{box-sizing:border-box} html,body{height:100%}
body{
  margin:0;color:var(--text);font-family:system-ui,Segoe UI,Prompt,sans-serif;
  background:
    radial-gradient(1100px 600px at 0% 0%,#19301f 0%,transparent 60%),
    radial-gradient(900px 700px at 100% 0%,#2a1a1a 0%,transparent 60%),
    radial-gradient(900px 900px at 50% 120%,#112019 0%,transparent 60%),
    linear-gradient(180deg,var(--bg),var(--bg2));
}
body::before{content:"";position:fixed;inset:0;z-index:-3;pointer-events:none;background:url("christmas-bg.png") center/cover no-repeat;opacity:.10;mix-blend-mode:screen}
/* ===== SNOW ===== */
.snow{position:fixed;inset:-120vh -20vw 0 -20vw;pointer-events:none;z-index:-2;background-repeat:repeat;will-change:background-position;mix-blend-mode:screen}
.s1{background-image:radial-gradient(2px 2px at 20px 20px,#fff8 90%,transparent),radial-gradient(2px 2px at 120px 80px,#fff8 90%,transparent),radial-gradient(2px 2px at 80px 140px,#fff8 90%,transparent);background-size:220px 220px,260px 260px,300px 300px;animation:fall1 10s linear infinite;opacity:.9}
.s2{background-image:radial-gradient(3px 3px at 40px 60px,#fffd 90%,transparent),radial-gradient(3px 3px at 160px 40px,#fffd 90%,transparent),radial-gradient(3px 3px at 100px 180px,#fffd 90%,transparent);background-size:320px 320px,380px 380px,420px 420px;animation:fall2 18s linear infinite;filter:blur(.3px);opacity:.85}
.s3{background-image:radial-gradient(4px 4px at 60px 30px,#ffff 90%,transparent),radial-gradient(4px 4px at 200px 90px,#ffff 90%,transparent),radial-gradient(4px 4px at 140px 220px,#ffff 90%,transparent);background-size:480px 480px,560px 560px,640px 640px;animation:fall3 28s linear infinite;filter:blur(.6px);opacity:.7}
@keyframes fall1{from{background-position:0 -120vh,-10vw -120vh,8vw -120vh}to{background-position:0 0,-10vw 0,8vw 0}}
@keyframes fall2{from{background-position:-8vw -120vh,6vw -120vh,0 -120vh}to{background-position:-8vw 0,6vw 0,0 0}}
@keyframes fall3{from{background-position:10vw -120vh,-6vw -120vh,4vw -120vh}to{background-position:10vw 0,-6vw 0,4vw 0}}
@media (prefers-reduced-motion:reduce){.s1,.s2,.s3{animation:none}}
/* ===== UI ===== */
a{color:var(--accent);text-decoration:none} img{max-width:100%;display:block}
.wrap{max-width:1100px;margin:auto;padding:20px}
.nav{display:flex;justify-content:space-between;align-items:center;gap:12px;background:linear-gradient(180deg,#132017,#0e1812);border:1px solid var(--border);border-radius:20px;padding:10px 14px;box-shadow:var(--shadow);backdrop-filter:blur(8px);position:sticky;top:12px;z-index:10}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:42px;height:42px;border-radius:12px;background:conic-gradient(from 220deg,#e53935,#36c06b,#ffd166,#e53935);display:grid;place-items:center;font-weight:900;color:#1b0d0d;box-shadow:0 0 18px #ffd16640}
.site-badge{font-size:12px;color:#ffe6a8;background:#182416;border:1px solid #274426;padding:3px 8px;border-radius:999px;display:inline-flex;gap:6px;align-items:center}
.btn{padding:9px 14px;border-radius:12px;border:1px solid var(--border);background:linear-gradient(180deg,#14241a,#0f1b14);color:#f2fff2;font-weight:700;cursor:pointer}
.btn[disabled]{opacity:.6;pointer-events:none}
.btn.primary{background:linear-gradient(90deg,var(--brand),var(--brand2));color:#1b0d0d;border:none;box-shadow:0 0 10px #ffd16650,0 0 28px #36c06b40;text-shadow:0 0 6px rgba(255,230,170,.6)}
.hero{margin-top:16px;display:grid;grid-template-columns:2fr 1fr;gap:18px}
.glass{background:linear-gradient(180deg,var(--glass),#0e1712cc);border:1px solid var(--border);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);backdrop-filter:blur(10px)}
.badge{padding:6px 10px;border-radius:999px;background:#1b2a1e;border:1px solid var(--border);display:inline-flex;gap:8px;align-items:center}
.drip{letter-spacing:.2px}
.glow{ text-shadow:0 0 6px rgba(255,209,102,.55),0 0 14px rgba(255,209,102,.45),0 0 28px rgba(54,192,107,.35);animation:glowPulse 2.6s ease-in-out infinite alternate}
@keyframes glowPulse{from{ text-shadow:0 0 6px rgba(255,209,102,.55),0 0 16px rgba(255,209,102,.45),0 0 28px rgba(54,192,107,.30)}to{ text-shadow:0 0 10px rgba(255,209,102,.9),0 0 24px rgba(255,209,102,.75),0 0 48px rgba(54,192,107,.55)}}
.statgrid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px}
.stat{background:#16281d;border:1px solid var(--border);border-radius:14px;text-align:center;padding:14px}
.muted{color:var(--muted)} .muted2{color:var(--muted2)}
.section{margin-top:22px}
.grid{display:grid;gap:16px}
.grid.pkg{grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
.grid.two{grid-template-columns:2fr 1fr}
.card{background:#102219;border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
label{display:block;margin-bottom:6px;color:#d6f0d8}
input,select,textarea{width:100%;background:#0f1a13;border:1px solid var(--border);color:#fff;padding:12px;border-radius:12px}
.price{font-size:22px;font-weight:900}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.summary{position:sticky;top:84px}
.tabs{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 0}
.tab{padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:#132319;cursor:pointer}
.tab.active{background:linear-gradient(90deg,var(--brand),var(--brand2));color:#1b0d0d;border:none;box-shadow:0 0 10px #ffd16650}
/* RIGHT HERO CART (‡πÅ‡∏ö‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏£‡∏Å) */
.cart-mini{display:grid;grid-template-columns:1fr 86px 86px 90px 28px;gap:8px;align-items:center;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:8px}
.cart-mini .left{display:grid;gap:2px}
.cart-mini input[type="number"]{width:100%;padding:8px;border-radius:10px;border:1px solid var(--border);background:#0f1a13;color:#fff;text-align:center}
.cart-mini .price,.cart-mini .sub{font-weight:800}
.cart-mini .del{background:transparent;border:none;color:#ff6b6b;font-size:18px;cursor:pointer}
@media (max-width:520px){.cart-mini{grid-template-columns:1fr 64px 64px 84px 28px}}
/* HISTORY */
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.06);text-align:left}
th{color:#ffe6a8}
.tools{display:flex;gap:8px;flex-wrap:wrap}
.pill{display:inline-flex;gap:6px;align-items:center;padding:4px 8px;border:1px solid var(--border);border-radius:999px;background:#132319}
/* COUNTDOWN STRIP */
.countdown-strip{margin-top:10px;background:linear-gradient(90deg,#213726,#182b20);border:1px solid var(--border);border-radius:12px;padding:10px 12px;display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.cd-label{font-weight:800;letter-spacing:.3px}
.cd-digits{font-family:ui-monospace,Menlo,Consolas,monospace;font-weight:900}
</style>
</head>
<body>
<!-- snow -->
<div class="snow s1"></div><div class="snow s2"></div><div class="snow s3"></div>

<!-- AUTH -->
<div class="auth" id="auth">
  <div class="panel">
    <h2 id="authTitle">üîí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</h2>
    <p id="authDesc" class="muted2">‡∏ï‡∏±‡πâ‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ + PIN (‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ)</p>
    <div id="setupForm">
      <div class="pair"><label>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label><input id="setupUser" placeholder="‡πÄ‡∏ä‡πà‡∏ô evan"/></div>
      <div class="pair"><label>PIN</label><input id="setupPin" type="password" inputmode="numeric" maxlength="6" placeholder="4‚Äì6 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç"/></div>
      <div class="pair"><label>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô PIN</label><input id="setupPin2" type="password" inputmode="numeric" maxlength="6" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ã‡πâ‡∏≥"/></div>
      <div class="pair"><label>‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏ö‡∏¥‡∏•</label><input id="setupName" placeholder="‡πÄ‡∏ä‡πà‡∏ô Ryu"/></div>
      <div class="pair"><label>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label><input id="setupContact" placeholder="Line/FB/Tel"/></div>
      <div class="tools"><button class="btn primary" id="btnSetup" type="button">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button></div>
      <div class="note">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô LocalStorage ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ</div>
    </div>
    <div id="loginForm" style="display:none">
      <div class="pair"><label>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label><input id="loginUser" placeholder="‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ"/></div>
      <div class="pair"><label>PIN</label><input id="loginPin" type="password" inputmode="numeric" maxlength="6" placeholder="PIN"/></div>
      <div class="tools">
        <button class="btn primary" id="btnLogin" type="button">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</button>
        <button class="btn" id="btnForgot" type="button">‡∏•‡∏∑‡∏° PIN</button>
      </div>
      <div class="note">‡∏•‡∏∑‡∏° PIN ‚Üí ‡πÉ‡∏ä‡πâ ‚Äú‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‚Äù ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‚Äú‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‚Äù</div>
    </div>
  </div>
</div>

<div class="wrap">
  <!-- NAV -->
  <nav class="nav">
    <div class="brand">
      <div class="logo">EV</div>
      <div>
        <div style="font-weight:900;letter-spacing:.5px">EVAN VALE</div>
        <div class="site-badge">üéÑ Christmas Event ‚Ä¢ ‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏ß ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</div>
      </div>
    </div>
    <div class="tools">
      <a class="btn" href="#packages">‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à</a>
      <a class="btn" href="#order">‡∏™‡∏±‡πà‡∏á‡πÄ‡∏ï‡∏¥‡∏°</a>
      <a class="btn" href="#history">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</a>
      <a class="btn primary" id="btnAdminNav" href="https://www.facebook.com/share/1JRkDmJDvX/" target="_blank" rel="noopener">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</a>
      <span class="pill">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤: <b id="cartCount">0</b></span>
      <button class="btn" id="btnLogout" style="display:none" type="button">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
  </nav>

  <!-- HERO -->
  <section class="hero">
    <div class="glass" style="position:relative">
      <span class="ribbon" id="ribbonTxt">CHRISTMAS üéÑ</span>
      <span class="badge">‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå 08:30‚Äì21:30</span>
      <h1 class="drip glow">EVAN VALE ‚Äî ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏î‡∏µ ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ <span style="color:var(--accent)">‡∏°‡∏µ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏î‡∏π‡πÅ‡∏•</span></h1>

      <div class="countdown-strip" id="cdStrip" aria-live="polite">
        <div class="cd-label">‚è≥ ‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏™‡∏π‡πà‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà</div>
        <div class="cd-digits" id="countdownDigits">-- ‡∏ß‡∏±‡∏ô --:--:--</div>
      </div>

      <div class="statgrid">
        <div class="stat"><div style="font-size:20px;font-weight:900">3‚Äì10 ‡∏ô‡∏≤‡∏ó‡∏µ*</div><div class="muted2">‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div></div>
        <div class="stat"><div style="font-size:20px;font-weight:900">1000+</div><div class="muted2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div></div>
        <div class="stat"><div style="font-size:20px;font-weight:900">0%</div><div class="muted2">‡∏¢‡∏∂‡∏î UID</div></div>
      </div>
      <p class="muted2" style="margin-top:8px">*‡∏ä‡πà‡∏ß‡∏á‡∏û‡∏µ‡∏Ñ/‡πÄ‡∏Å‡∏°‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏≠‡∏≤‡∏à‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥</p>
    </div>

    <!-- RIGHT PANEL: CART ‡πÅ‡∏ö‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏£‡∏Å -->
    <aside class="glass summary">
      <h3 style="margin:0">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</h3>
      <div id="cartCompact" style="display:grid;gap:8px"></div>
      <div style="height:1px;background:rgba(255,255,255,.12);margin:8px 0"></div>
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <span class="pill">‡∏£‡∏ß‡∏°: <b id="heroGrand">‡∏ø0</b></span>
        <a class="btn primary" href="#order">‡πÑ‡∏õ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</a>
        <button class="btn" id="btnClearCart" type="button">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
      </div>
    </aside>
  </section>

  <!-- PACKAGES -->
  <section id="packages" class="section">
    <div class="card">
      <h2 style="margin:0">‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à‡∏¢‡∏≠‡∏î‡∏Æ‡∏¥‡∏ï</h2>
      <div class="tabs" id="game-tabs"></div>
      <p class="muted2" style="margin:6px 0 10px">‡∏Ñ‡∏•‡∏¥‡∏Å ‚Äú‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ ‚Äú‡∏™‡∏±‡πà‡∏á‡πÄ‡∏ï‡∏¥‡∏°‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏¥‡∏•</p>
      <div class="grid pkg" id="pkg-grid"></div>
    </div>
  </section>

  <!-- ORDER -->
  <section id="order" class="section grid two" style="align-items:start">
    <div class="card">
      <h2 style="margin-top:0">‡∏™‡∏±‡πà‡∏á‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏°</h2>
      <div class="row">
        <div>
          <label>‡πÇ‡∏ã‡∏ô/‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</label>
          <select id="server"></select>
          <p id="thaiOnlyNote" style="display:none;color:#ffd166;font-size:14px;margin:6px 0 0;background:#142318;padding:6px 10px;border-radius:6px;border-left:3px solid var(--brand);">‚ö†Ô∏è ‡πÄ‡∏Å‡∏°‡∏ô‡∏µ‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ <b>‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏ó‡∏¢</b> (‡∏ö‡∏≤‡∏á‡πÄ‡∏Å‡∏°)</p>
        </div>
        <div>
          <label>UID / Player ID</label>
          <input id="uid" placeholder="‡πÄ‡∏ä‡πà‡∏ô 812345678 ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡πÄ‡∏Å‡∏°">
        </div>
      </div>
      <div class="row">
        <div>
          <label>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞</label>
          <select id="method"><option>PromptPay</option><option>TrueMoney Wallet</option><option>‡πÇ‡∏≠‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</option></select>
        </div>
        <div>
          <label>‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
          <input id="promo" placeholder="‡πÄ‡∏ä‡πà‡∏ô EVAN10">
        </div>
      </div>
      <div class="row">
        <div>
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
          <input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ">
        </div>
        <div>
          <label>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label>
          <input id="contact" placeholder="Line/FB/Tel">
        </div>
      </div>
      <div class="tools" style="margin-top:12px">
        <button class="btn" id="btnReset" type="button">‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
        <button class="btn primary" id="btnSubmit" type="button" disabled>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏¥‡∏•</button>
        <button class="btn" id="btnSaveProfile" type="button" disabled>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</button>
      </div>
      <p class="muted2" style="margin-top:8px">‡∏ï‡πâ‡∏≠‡∏á ‚Äú‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‚Äù ‡πÅ‡∏•‡∏∞ ‚Äú‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á‚Äù ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏¥‡∏•‡πÑ‡∏î‡πâ</p>
    </div>

    <aside class="card summary">
      <h3 style="margin-top:0">‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏•</h3>
      <div class="list" id="billList"></div>
      <div style="height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.12),transparent);margin:10px 0"></div>
      <div class="item"><span class="muted2">‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•</span><span id="sum-bill">-</span></div>
      <div class="item"><span class="muted2">‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞</span><span id="sum-method">-</span></div>
      <div class="item"><span class="muted2">UID</span><span id="sum-uid">-</span></div>
      <div class="item"><span class="muted2">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span><span class="total" id="sum-total">‡∏ø0</span></div>
    </aside>
  </section>

  <!-- PAYMENT -->
  <section id="pay" class="section" style="display:none">
    <div class="card">
      <h2 style="margin-top:0">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
      <p class="muted2">‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á ‚Üí ‚Äú‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏•‚Äù ‚Üí ‚Äú‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‚Äù</p>
      <div class="grid pkg">
        <div class="glass" style="text-align:center">
          <div style="font-weight:800;margin-bottom:8px">TrueMoney Wallet</div>
          <img src="truemoney.png" alt="TrueMoney QR" style="border-radius:12px">
          <div class="muted2" style="margin-top:6px">‡∏™‡πÅ‡∏Å‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏≠‡∏õ TrueMoney</div>
        </div>
        <div class="glass" style="text-align:center">
          <div style="font-weight:800;margin-bottom:8px">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå / ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</div>
          <img src="promptpay.png" alt="PromptPay QR" style="border-radius:12px">
          <div class="muted2" style="margin-top:6px">‡∏™‡πÅ‡∏Å‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏≠‡∏õ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</div>
        </div>
      </div>

      <div class="glass" style="margin-top:14px">
        <h3 style="margin-top:0">‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</h3>
        <div class="row">
          <div>
            <label>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ</label>
            <input id="slip" type="file" accept="image/*">
            <div class="muted2" style="margin-top:6px">‡πÄ‡∏ß‡πá‡∏ö‡∏™‡πÅ‡∏ï‡∏ï‡∏¥‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå ‚Äî ‡πÅ‡∏ô‡∏ö‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡πÅ‡∏ä‡∏ó‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô</div>
          </div>
          <div>
            <label>‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
            <input id="ref" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2025-XX-XX">
          </div>
        </div>

        <div class="tools" style="margin-top:12px">
          <button class="btn" id="btnBackToForm" type="button">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
          <button class="btn primary" id="btnPrepareMsg" type="button" disabled>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏•</button>
          <button class="btn" id="btnMarkPaid" type="button" disabled>‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</button>
          <a class="btn" id="btnOpenAdmin" href="#" target="_blank" rel="noopener" style="pointer-events:none;opacity:.6">‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</a>
        </div>

        <div id="copyHint" class="muted2" style="display:none;margin-top:8px">‚úîÔ∏è ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡∏ñ‡πâ‡∏≤‡πÅ‡∏ä‡∏ó‡πÑ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á ‡πÉ‡∏´‡πâ ‚Äú‡∏ß‡∏≤‡∏á (Paste)‚Äù</div>
        <textarea id="msgPreview" readonly style="display:none;width:100%;margin-top:8px;background:#0f1a13;color:#f8fff6;border:1px solid #203326;border-radius:10px;padding:10px" rows="8"></textarea>
      </div>
    </div>
  </section>

  <!-- HISTORY -->
  <section id="history" class="section">
    <div class="card">
      <h2 style="margin:0">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h2>
      <div class="tools" style="margin:10px 0">
        <input id="histSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: ‡∏ö‡∏¥‡∏•/‡πÄ‡∏Å‡∏°/UID/‡∏ä‡∏∑‡πà‡∏≠" style="max-width:260px">
        <select id="histGameFilter" class="pill"><option value="">‡∏ó‡∏∏‡∏Å‡πÄ‡∏Å‡∏°</option></select>
        <select id="histStatusFilter" class="pill">
          <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option><option>‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞</option><option>‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡πâ‡∏ß</option><option>‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</option><option>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
        </select>
        <button class="btn" id="btnExportCsv" type="button">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV</button>
        <button class="btn" id="btnClearAll" type="button">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      </div>

      <div class="glass table-scroll">
        <table id="histTable">
          <thead><tr><th>‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•</th><th>‡πÄ‡∏Å‡∏°</th><th>‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à</th><th>‡∏¢‡∏≠‡∏î</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>UID</th><th>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠</th></tr></thead>
          <tbody></tbody>
        </table>
        <div id="histEmpty" class="muted2" style="padding:8px 0;display:none">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
      </div>
    </div>
  </section>

  <div class="footer">¬© 2025 Evan Vale ‚Ä¢ Christmas Event</div>
</div>

<script>
/* ===== AUTH / SESSION ===== */
const KEY_USER="ev_auth_user";
const KEY_SESSION="ev_auth_session";
function ordersKey(){ const u=userBox(); return u? `ev_orders_${u.user}` : "ev_orders__guest"; }
function cartKey(){ const u=userBox(); return u? `ev_cart_${u.user}` : "ev_cart__guest"; }

async function sha256(str){const enc=new TextEncoder().encode(str);const buf=await crypto.subtle.digest('SHA-256',enc);return[...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,'0')).join('')}
function simpleHash(s){let h=2166136261>>>0;for(let i=0;i<s.length;i++){h^=s.charCodeAt(i);h=(h*16777619)>>>0;}return'fhv1-'+h.toString(16)}
async function hashSafe(str){try{if(!crypto?.subtle)throw new Error('no subtle');return await sha256(str);}catch{return simpleHash(str)}}
function userBox(){try{return JSON.parse(localStorage.getItem(KEY_USER)||"null")}catch{return null}}
function setUserBox(v){localStorage.setItem(KEY_USER,JSON.stringify(v))}
function setSession(on){if(on){sessionStorage.setItem(KEY_SESSION,"ok")}else{sessionStorage.removeItem(KEY_SESSION)}}
function isLogged(){return sessionStorage.getItem(KEY_SESSION)==="ok"}
function showAuth(show){document.getElementById('auth').classList.toggle('hide',!show)}
function toggleProtected(disabled){
  document.getElementById('btnSubmit').disabled=disabled||loadCart().length===0;
  document.getElementById('btnPrepareMsg').disabled=disabled;
  document.getElementById('btnSaveProfile').disabled=disabled;
  document.getElementById('btnLogout').style.display=disabled?"none":"inline-block";
}

/* ===== DATA ===== */
const ADMIN_URL="https://www.facebook.com/share/1JRkDmJDvX/";
const GAMES=[
  {key:"Free Fire",icon:"üî•",servers:["Thailand","SEA","Global","‡∏≠‡∏∑‡πà‡∏ô‡πÜ"]},
  {key:"RoV",icon:"üõ°Ô∏è",servers:["Thailand","Vietnam","Taiwan","‡∏≠‡∏∑‡πà‡∏ô‡πÜ"]},
  {key:"Genshin Impact",icon:"‚ú®",servers:["‡πÄ‡∏≠‡πÄ‡∏ä‡∏µ‡∏¢ (Asia)","‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤ (America)","‡∏¢‡∏∏‡πÇ‡∏£‡∏õ (Europe)","TW, HK, MO","‡∏≠‡∏∑‡πà‡∏ô‡πÜ"]},
  {key:"Honkai: Star Rail",icon:"üöÑ",servers:["‡πÄ‡∏≠‡πÄ‡∏ä‡∏µ‡∏¢ (Asia)","‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤ (America)","‡∏¢‡∏∏‡πÇ‡∏£‡∏õ (Europe)","TW, HK, MO","‡∏≠‡∏∑‡πà‡∏ô‡πÜ"]},
  {key:"PUBG Mobile",icon:"üéØ",servers:["Thailand","SEA","KRJP","Global","‡∏≠‡∏∑‡πà‡∏ô‡πÜ"]},
  {key:"Roblox",icon:"üß±",servers:["Thailand","Asia","USA","Global","‡∏≠‡∏∑‡πà‡∏ô‡πÜ"]},
  {key:"Call of Duty",icon:"üéÆ",servers:["Thailand","SEA","Global","‡∏≠‡∏∑‡πà‡∏ô‡πÜ"]},
  {key:"Wuthering Waves",icon:"üåä",servers:["‡πÄ‡∏≠‡πÄ‡∏ä‡∏µ‡∏¢ (Asia)","‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤ (America)","‡∏¢‡∏∏‡πÇ‡∏£‡∏õ (Europe)","TW, HK, MO","‡∏≠‡∏∑‡πà‡∏ô‡πÜ"]},
];
const PACKS_BY_GAME={
  "Free Fire":[{name:"33 ‡πÄ‡∏û‡∏ä‡∏£",price:11},{name:"68 ‡πÄ‡∏û‡∏ä‡∏£",price:21},{name:"172 ‡πÄ‡∏û‡∏ä‡∏£",price:49},{name:"310 ‡πÄ‡∏û‡∏ä‡∏£",price:87},{name:"517 ‡πÄ‡∏û‡∏ä‡∏£",price:145}],
  "RoV":[{name:"60 ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á",price:49},{name:"110 ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á",price:87},{name:"185 ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á",price:144}],
  "Genshin Impact":[{name:"300+30 Genesis Crystals",price:145},{name:"980+110 Genesis Crystals",price:420},{name:"Blessing (‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)",price:179}],
  "Honkai: Star Rail":[{name:"300+30 Shard",price:145},{name:"980+110 Shard",price:425},{name:"Express Supply Pass",price:145}],
  "PUBG Mobile":[{name:"325 UC",price:179},{name:"660 UC",price:346},{name:"1800 UC",price:860}],
  "Roblox":[{name:"80 Robux",price:35},{name:"400 Robux",price:175},{name:"800 Robux",price:350}],
  "Call of Duty":[{name:"108 ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 30 CP",price:52},{name:"324 ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 90 CP",price:152}],
  "Wuthering Waves":[{name:"300+30 Lunite",price:179},{name:"980+110 Lunite",price:549}]
};

/* ===== HELPERS ===== */
const $=q=>document.querySelector(q);
function money(n){return"‡∏ø"+Number(n||0).toLocaleString('th-TH',{maximumFractionDigits:0})}
function pad(n){return n.toString().padStart(2,'0')}
function genInvoice(){const d=new Date();const ts=`${d.getFullYear()}${pad(d.getMonth()+1)}${pad(d.getDate())}-${pad(d.getHours())}${pad(d.getMinutes())}${pad(d.getSeconds())}`;const rnd=Math.floor(Math.random()*8999)+1000;return`EV-${ts}-${rnd}`}

/* ===== CART STORAGE ===== */
function loadCart(){try{ return JSON.parse(localStorage.getItem(cartKey())||"[]")}catch{return []}}
function saveCart(v){localStorage.setItem(cartKey(),JSON.stringify(v))}
function addToCart(game,pack){
  const cart=loadCart();
  const key=game+"|"+pack.name;
  const idx=cart.findIndex(i=>i.key===key);
  if(idx>-1){cart[idx].qty+=1;}else{cart.push({key,game,name:pack.name,price:pack.price,qty:1});}
  saveCart(cart); renderCartCompact(); updateOrderSummary(); updateSubmitState(); alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‚úÖ');
}
function updateSubmitState(){
  const ok = isLogged() && loadCart().length>0;
  document.getElementById('btnSubmit').disabled=!ok;
  document.getElementById('btnSaveProfile').disabled=!isLogged();
  $("#cartCount").textContent=loadCart().length;
}

/* ===== UI: PACKAGES ===== */
let currentGame=GAMES[0].key;
const tabsEl=$("#game-tabs"); const pkgGrid=$("#pkg-grid"); const serverSel=$("#server");
function renderGameTabs(){
  tabsEl.innerHTML="";
  GAMES.forEach(g=>{
    const t=document.createElement('div');
    t.className='tab'+(g.key===currentGame?' active':'');
    t.textContent=`${g.icon} ${g.key}`;
    t.onclick=()=>{currentGame=g.key; renderGameTabs(); renderServers(); renderPacks();}
    tabsEl.appendChild(t);
  });
}
function renderServers(){
  serverSel.innerHTML="";
  (GAMES.find(x=>x.key===currentGame)?.servers||["Global"]).forEach(s=>{
    const o=document.createElement('option');o.value=s;o.textContent=s;serverSel.appendChild(o);
  });
  document.getElementById('thaiOnlyNote').style.display = ["Free Fire","RoV","PUBG Mobile","Roblox","Call of Duty"].includes(currentGame)?"block":"none";
}
function renderPacks(){
  const packs=PACKS_BY_GAME[currentGame]||[];
  pkgGrid.innerHTML="";
  packs.forEach(p=>{
    const card=document.createElement('div');card.className="glass";
    card.innerHTML=`<div style="font-weight:800">${p.name}</div>
                    <div class="price">${money(p.price)}</div>
                    <div style="margin-top:10px"><button class="btn primary" type="button">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button></div>`;
    card.querySelector('button').onclick=()=>addToCart(currentGame,p);
    pkgGrid.appendChild(card);
  });
}

/* ===== RIGHT HERO CART ===== */
function renderCartCompact(){
  const box=$("#cartCompact"); const cart=loadCart(); box.innerHTML=""; let total=0;
  cart.forEach((it,i)=>{
    const sub=it.qty*it.price; total+=sub;
    const row=document.createElement('div');row.className='cart-mini';
    row.innerHTML=`
      <div class="left"><b>${it.game}</b><div class="muted">‚Ä¢ ${it.name}</div></div>
      <input type="number" min="1" value="${it.qty}" data-i="${i}">
      <div class="price">‡∏ø${it.price}</div>
      <div class="sub">‡∏ø${sub}</div>
      <button class="del" data-i="${i}">√ó</button>`;
    box.appendChild(row);
  });
  $("#heroGrand").textContent=money(total);
  $("#cartCount").textContent=cart.length;

  // events
  box.querySelectorAll('input[type="number"]').forEach(inp=>{
    inp.onchange=e=>{
      const i=+e.target.dataset.i; const cart=loadCart();
      cart[i].qty=Math.max(1,parseInt(e.target.value||'1')); saveCart(cart);
      renderCartCompact(); updateOrderSummary(); updateSubmitState();
    };
  });
  box.querySelectorAll('button.del').forEach(btn=>{
    btn.onclick=()=>{const i=+btn.dataset.i; const cart=loadCart(); cart.splice(i,1); saveCart(cart); renderCartCompact(); updateOrderSummary(); updateSubmitState();};
  });
}
document.getElementById('btnClearCart').onclick=()=>{ if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')){ saveCart([]); renderCartCompact(); updateOrderSummary(); updateSubmitState(); } };

/* ===== SUMMARY / BILL (right of ORDER) ===== */
function updateOrderSummary(){
  const billList=$("#billList"); const cart=loadCart(); billList.innerHTML=""; let total=0;
  cart.forEach(it=>{
    const line=document.createElement('div'); line.style.display='flex'; line.style.justifyContent='space-between';
    line.innerHTML=`<span class="muted2">${it.game} ‚Ä¢ ${it.name} √ó ${it.qty}</span><b>${money(it.qty*it.price)}</b>`;
    total+=it.qty*it.price; billList.appendChild(line);
  });
  document.getElementById('sum-total').textContent=money(total);
  document.getElementById('sum-uid').textContent=($("#uid").value||"-");
  document.getElementById('sum-method').textContent=$("#method").value||"-";
}
["uid","method"].forEach(id=>{document.getElementById(id).addEventListener('input',updateOrderSummary);document.getElementById(id).addEventListener('change',updateOrderSummary)});

/* ===== HISTORY / ORDERS ===== */
function loadOrders(){try{return JSON.parse(localStorage.getItem(ordersKey())||"[]")}catch{return[]}}
function saveOrders(list){localStorage.setItem(ordersKey(),JSON.stringify(list))}
function addOrder(row){const list=loadOrders();list.unshift(row);saveOrders(list);renderHistory()}
function updateOrderStatus(inv,status){const list=loadOrders();const idx=list.findIndex(x=>x.invoiceId===inv);if(idx>-1){list[idx].status=status;saveOrders(list);renderHistory()}}
function deleteOrder(inv){const list=loadOrders().filter(x=>x.invoiceId!==inv);saveOrders(list);renderHistory()}

const histTableBody=document.querySelector('#histTable tbody');
const histEmpty=document.getElementById('histEmpty');
const histSearch=document.getElementById('histSearch');
const histGameFilter=document.getElementById('histGameFilter');
const histStatusFilter=document.getElementById('histStatusFilter');

function initHistoryFilters(){
  histGameFilter.innerHTML='<option value="">‡∏ó‡∏∏‡∏Å‡πÄ‡∏Å‡∏°</option>'+GAMES.map(g=>`<option>${g.key}</option>`).join('');
  [histSearch,histGameFilter,histStatusFilter].forEach(el=>{
    el.addEventListener('input',renderHistory);el.addEventListener('change',renderHistory);
  });
}
function renderHistory(){
  const q=(histSearch.value||"").toLowerCase();const g=histGameFilter.value||"";const st=histStatusFilter.value||"";
  const list=loadOrders().filter(x=>{
    const inTxt=(x.invoiceId+x.items.map(i=>i.game+i.name).join('')+(x.uid||'')+(x.name||'')).toLowerCase().includes(q);
    const gOk=g? x.items.some(i=>i.game===g):true; const sOk=st?x.status===st:true; return inTxt&&gOk&&sOk;
  });
  histTableBody.innerHTML=""; histEmpty.style.display=list.length?"none":"block";
  list.forEach(x=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${new Date(x.ts).toLocaleString()}</td>
      <td>${x.invoiceId}</td>
      <td>${[...new Set(x.items.map(i=>i.game))].join('/')}</td>
      <td>${x.items.map(i=>i.name+'√ó'+i.qty).join(' / ')}</td>
      <td>${x.total}</td>
      <td>
        <select data-inv="${x.invoiceId}">
          ${["‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞","‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡πâ‡∏ß","‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß","‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"].map(s=>`<option ${x.status===s?"selected":""}>${s}</option>`).join('')}
        </select>
      </td>
      <td>${x.uid||"-"}</td>
      <td>
        <button class="btn" data-view="${x.invoiceId}" type="button">‡∏î‡∏π</button>
        <button class="btn" data-del="${x.invoiceId}" type="button">‡∏•‡∏ö</button>
      </td>`;
    histTableBody.appendChild(tr);
  });
  histTableBody.querySelectorAll('button[data-del]').forEach(b=>b.onclick=()=>deleteOrder(b.getAttribute('data-del')));
  histTableBody.querySelectorAll('button[data-view]').forEach(b=>b.onclick=()=>{
    const inv=b.getAttribute('data-view'); const x=loadOrders().find(o=>o.invoiceId===inv); if(!x)return;
    alert(`‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•: ${x.invoiceId}
‡πÄ‡∏ß‡∏•‡∏≤: ${new Date(x.ts).toLocaleString()}
‡πÄ‡∏Å‡∏°: ${[...new Set(x.items.map(i=>i.game))].join('/')}
‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à: ${x.items.map(i=>i.name+'√ó'+i.qty).join(' / ')}
‡∏¢‡∏≠‡∏î: ${x.total}
‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞: ${x.method}
UID: ${x.uid||"-"}
‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${x.name||"-"} | ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠: ${x.contact||"-"}
‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${x.status}`);
  });
  histTableBody.querySelectorAll('select[data-inv]').forEach(s=>s.onchange=()=>updateOrderStatus(s.getAttribute('data-inv'),s.value));
}

/* ===== COPY / ADMIN ===== */
function buildMessage(order){
  return `‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏° Evan Vale
‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•: ${order.invoiceId}
‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${order.items.map(i=>i.game+' ‚Ä¢ '+i.name+' √ó '+i.qty).join(', ')}
‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${order.total}
‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞: ${order.method}
UID: ${order.uid||'-'}
‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${order.name||'-'} | ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠: ${order.contact||'-'}
‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á: ${(document.getElementById('ref')?.value||'-')}`;}
const btnPrepare=document.getElementById('btnPrepareMsg');
const btnOpenAdmin=document.getElementById('btnOpenAdmin');
const msgPreview=document.getElementById('msgPreview');
const copyHint=document.getElementById('copyHint');
function makeAdminUrl(){return ADMIN_URL}
async function copyTextSafe(text){try{await navigator.clipboard.writeText(text);return true;}catch{const ta=document.createElement('textarea');ta.value=text;ta.style.position='fixed';ta.style.opacity='0';document.body.appendChild(ta);ta.focus();ta.select();let ok=false;try{ok=document.execCommand('copy')}catch{}document.body.removeChild(ta);return!!ok}}

btnPrepare?.addEventListener('click',async()=>{
  if(!isLogged()){alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô');return;}
  if(!window.invoiceId||window.invoiceId==='-'){alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏¥‡∏•');return;}
  const ord=loadOrders().find(o=>o.invoiceId===window.invoiceId); if(!ord){alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ö‡∏¥‡∏•');return;}
  const msg=buildMessage(ord);
  msgPreview.value=msg; msgPreview.style.display='block';
  copyHint.style.display='block'; copyHint.textContent='‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏•...';
  const copied=await copyTextSafe(msg);
  copyHint.textContent=copied?'‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏•‡πÅ‡∏•‡πâ‡∏ß ‚úÖ ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏Å‡∏î "‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô"':'‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô';
  btnOpenAdmin.href=makeAdminUrl(); btnOpenAdmin.style.pointerEvents='auto'; btnOpenAdmin.style.opacity='1';
  updateOrderStatus(window.invoiceId,'‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡πâ‡∏ß');
});
btnOpenAdmin?.addEventListener('click',e=>{if(!btnOpenAdmin.href||btnOpenAdmin.getAttribute('href')==='#'){e.preventDefault();window.open(makeAdminUrl(),'_blank')}});

/* ===== FORM ACTIONS ===== */
document.getElementById('btnReset').addEventListener('click',()=>{document.querySelectorAll('#order input').forEach(i=>i.value="");updateOrderSummary()});
window.invoiceId="-";
document.getElementById('btnSubmit').addEventListener('click',()=>{
  if(!isLogged()){alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô');return;}
  const cart=loadCart(); if(!cart.length){alert('‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á');return;}
  window.invoiceId=genInvoice(); document.getElementById('sum-bill').innerText=window.invoiceId;

  const total=cart.reduce((s,x)=>s+x.qty*x.price,0);
  const row={
    ts:Date.now(), invoiceId:window.invoiceId,
    items:cart.map(x=>({game:x.game,name:x.name,qty:x.qty,price:x.price})),
    total:money(total),
    method:document.getElementById('method').value,
    uid:document.getElementById('uid').value.trim(),
    name:document.getElementById('name').value.trim(),
    contact:document.getElementById('contact').value.trim(),
    status:'‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞'
  };
  addOrder(row);

  // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ pay + ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
  document.getElementById('pay').style.display=""; document.getElementById('pay').scrollIntoView({behavior:'smooth'});
  saveCart([]); renderCartCompact(); updateOrderSummary(); updateSubmitState();
});
document.getElementById('btnBackToForm').addEventListener('click',()=>{document.getElementById('pay').style.display="none";document.getElementById('order').scrollIntoView({behavior:'smooth'})});

/* ===== EXPORT / CLEAR ===== */
document.getElementById('btnExportCsv').addEventListener('click',()=>{
  const list=loadOrders(); if(!list.length){alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');return;}
  const header=["‡πÄ‡∏ß‡∏•‡∏≤","‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•","‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","‡∏¢‡∏≠‡∏î","‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞","UID","‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤","‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠"].join(",");
  const rows=list.map(x=>[
    new Date(x.ts).toLocaleString().replaceAll(","," "),
    x.invoiceId,
    x.items.map(i=>i.game+"‚Ä¢"+i.name+"√ó"+i.qty).join("/"),
    x.total,x.status,x.uid||"-",x.name||"-",x.contact||"-"
  ].map(v=>`"${String(v).replaceAll('"','""')}"`).join(",")).join("\n");
  const blob=new Blob([header+"\n"+rows],{type:"text/csv;charset=utf-8"});
  const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='evan_orders.csv'; a.click(); URL.revokeObjectURL(url);
});
document.getElementById('btnClearAll').addEventListener('click',()=>{
  if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ? (‡∏£‡∏ß‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ/‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥/‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤)')){
    localStorage.removeItem(KEY_USER); sessionStorage.removeItem(KEY_SESSION);
    localStorage.removeItem(ordersKey()); localStorage.removeItem(cartKey()); location.reload();
  }
});

/* ===== PROFILE SAVE/FILL ===== */
function fillFromProfile(){
  const ub=userBox(); if(!ub) return;
  if(ub.name)document.getElementById('name').value=ub.name;
  if(ub.contact)document.getElementById('contact').value=ub.contact;
  updateOrderSummary();
}
document.getElementById('btnSaveProfile').addEventListener('click',()=>{
  if(!isLogged()){alert('‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô');return;}
  const ub=userBox(); if(!ub){alert('‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Å‡πà‡∏≠‡∏ô');return;}
  ub.name=document.getElementById('name').value.trim();
  ub.contact=document.getElementById('contact').value.trim();
  setUserBox(ub); alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß ‚úÖ');
});

/* ===== AUTH FLOW ===== */
function renderAuth(){
  const ub=userBox(); const hasUser=!!ub;
  document.getElementById('authTitle').textContent=hasUser?'üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö':'üîí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å';
  document.getElementById('authDesc').textContent=hasUser?'‡πÉ‡∏™‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞ PIN ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô':'‡∏ï‡∏±‡πâ‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ + PIN ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)';
  document.getElementById('setupForm').style.display=hasUser?'none':'block';
  document.getElementById('loginForm').style.display=hasUser?'block':'none';
}
async function tryAutoLogin(){
  if(isLogged()){
    showAuth(false); toggleProtected(false);
    fillFromProfile(); initHistoryFilters(); renderHistory(); updateOrderSummary(); updateSubmitState();
    return;
  }
  renderAuth(); showAuth(true); toggleProtected(true);
}
document.getElementById('btnSetup').addEventListener('click',async()=>{
  const user=document.getElementById('setupUser').value.trim();
  const p1=document.getElementById('setupPin').value.trim();
  const p2=document.getElementById('setupPin2').value.trim();
  if(!user||p1.length<4||p1!==p2){alert('‡∏ï‡∏£‡∏ß‡∏à‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ/PIN (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏´‡∏•‡∏±‡∏Å ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô)');return;}
  const name=document.getElementById('setupName').value.trim();
  const contact=document.getElementById('setupContact').value.trim();
  const pinHash=await hashSafe(user+'|'+p1);
  setUserBox({user,pinHash,name,contact});
  setSession(true);
  showAuth(false); toggleProtected(false);
  fillFromProfile(); initHistoryFilters(); renderHistory(); updateOrderSummary(); updateSubmitState();
});
document.getElementById('btnLogin').addEventListener('click',async()=>{
  const user=document.getElementById('loginUser').value.trim();
  const pin=document.getElementById('loginPin').value.trim();
  const ub=userBox(); if(!ub){alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Å‡πà‡∏≠‡∏ô');return;}
  const hash=await hashSafe(user+'|'+pin);
  if(hash===ub.pinHash){
    setSession(true); showAuth(false); toggleProtected(false);
    fillFromProfile(); initHistoryFilters(); renderHistory(); updateOrderSummary(); updateSubmitState();
  }else{alert('‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠ PIN ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á')}
});
document.getElementById('btnForgot').addEventListener('click',()=>alert('‡∏•‡∏∑‡∏° PIN: ‡πÉ‡∏ä‡πâ ‚Äú‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‚Äù ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‚Äú‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‚Äù'));
document.getElementById('btnLogout').addEventListener('click',()=>{setSession(false);showAuth(true);toggleProtected(true);updateSubmitState();});

/* ===== MARK AS PAID ===== */
const slipInput=document.getElementById('slip'); const refInput=document.getElementById('ref'); const btnMarkPaid=document.getElementById('btnMarkPaid');
function canMarkPaid(){const hasSlip=slipInput&&slipInput.files&&slipInput.files.length>0;const hasRef=(refInput?.value||'').trim().length>0;return !!window.invoiceId && window.invoiceId!=='-' && (hasSlip||hasRef)}
function updateMarkPaidState(){btnMarkPaid.disabled=!canMarkPaid()}
slipInput?.addEventListener('change',updateMarkPaidState); refInput?.addEventListener('input',updateMarkPaidState);
btnMarkPaid?.addEventListener('click',()=>{if(!window.invoiceId||window.invoiceId==='-'){alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•');return;} if(!canMarkPaid()){alert('‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏Å‡πà‡∏≠‡∏ô');return;} updateOrderStatus(window.invoiceId,'‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß'); alert('‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß ‚úÖ ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î');});

/* ===== COUNTDOWN ===== */
const cdDigits=document.getElementById('countdownDigits'); const ribbonTxt=document.getElementById('ribbonTxt');
(function runCountdown(){const target=new Date('2026-01-01T00:00:00+07:00').getTime();function fmt2(n){return n.toString().padStart(2,'0')}function tick(){const now=Date.now();let diff=target-now;if(diff<=0){cdDigits.textContent='00 ‡∏ß‡∏±‡∏ô 00:00:00';ribbonTxt.textContent='üéâ HAPPY NEW YEAR 2026';ribbonTxt.style.boxShadow='0 0 20px #ffd166aa,0 0 40px #36c06baa';return;}const d=Math.floor(diff/86400000);diff%=86400000;const h=Math.floor(diff/3600000);diff%=3600000;const m=Math.floor(diff/60000);diff%=60000;const s=Math.floor(diff/1000);cdDigits.textContent=`${fmt2(d)} ‡∏ß‡∏±‡∏ô ${fmt2(h)}:${fmt2(m)}:${fmt2(s)}`;setTimeout(tick,200)}tick()})();

/* ===== INIT ===== */
function boot(){
  renderGameTabs(); renderServers(); renderPacks();
  renderCartCompact(); updateOrderSummary(); initHistoryFilters(); tryAutoLogin(); updateSubmitState();
}
boot();
</script>
</body>
</html>
