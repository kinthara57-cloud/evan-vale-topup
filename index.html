<!DOCTYPE html>
} else {
const text = decodeURIComponent(encoded.replaceAll('%0A','\n'));
navigator.clipboard.writeText(text).then(()=>{
msg.textContent = 'คัดลอกข้อความแล้ว — วางส่งให้ร้านได้เลย';
setTimeout(()=> msg.textContent='', 3000);
});
}
});


// LOCAL STORAGE — รายการของฉัน (บันทึกในเครื่อง)
const saveBtn = $('#saveLocal');
const listEl = $('#myList');


function renderList(){
listEl.innerHTML = '';
const arr = JSON.parse(localStorage.getItem('wk-myorders')||'[]');
if(arr.length===0){
listEl.innerHTML = '<div class="card">ยังไม่มีรายการที่บันทึก</div>';
return;
}
arr.forEach((it, i)=>{
const card = document.createElement('div');
card.className = 'card';
card.innerHTML = `<h3 style="margin:0 0 6px">${it.service} • ${it.vehicle}</h3>`+
`<p style="margin:0 0 8px; color:var(--muted)">จองโดย ${it.name} | ${it.phone} | ${it.datetime || '-'}</p>`+
`<div style="display:flex; gap:8px; flex-wrap:wrap">`+
`<button data-i="${i}" class="btn" data-act="send">ส่งอีกครั้ง</button>`+
`<button data-i="${i}" class="btn" data-act="copy">คัดลอก</button>`+
`<button data-i="${i}" class="btn" data-act="del" style="background:#181d1a; border:1px solid rgba(255,255,255,.12)">ลบ</button>`+
`</div>`;
listEl.appendChild(card);
});
}


saveBtn.addEventListener('click', ()=>{
const fd = new FormData(form);
const data = Object.fromEntries(fd.entries());
const arr = JSON.parse(localStorage.getItem('wk-myorders')||'[]');
arr.unshift({...data, ts: Date.now()});
localStorage.setItem('wk-myorders', JSON.stringify(arr.slice(0,20)));
msg.textContent = 'บันทึกไว้ในเครื่องนี้แล้ว';
setTimeout(()=> msg.textContent='', 3000);
renderList();
});


listEl.addEventListener('click', (e)=>{
const btn = e.target.closest('button');
if(!btn) return;
const i = +btn.dataset.i;
const arr = JSON.parse(localStorage.getItem('wk-myorders')||'[]');
const it = arr[i];
if(btn.dataset.act==='del'){
arr.splice(i,1);
localStorage.setItem('wk-myorders', JSON.stringify(arr));
renderList();
}
if(btn.dataset.act==='copy'){
const t = decodeURIComponent(buildMessage(it).replaceAll('%0A','\n'));
navigator.clipboard.writeText(t);
}
if(btn.dataset.act==='send'){
const url = `https://line.me/R/ti/p/@waykingarage?text=${buildMessage(it)}`;
window.open(url, '_blank');
}
});


renderList();
</script>
</body>
</html>
