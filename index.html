<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0a0f0b">
  <title>EVAN VALE ‚Ä¢ Christmas Event | ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏î‡∏µ ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ ‡∏°‡∏µ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏î‡∏π‡πÅ‡∏•</title>
  <meta name="description" content="EVAN VALE Christmas Event ‚Äî ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏î‡∏µ ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡∏°‡∏µ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏î‡∏π‡πÅ‡∏• 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö TrueMoney, PromptPay ‡πÅ‡∏•‡∏∞‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£" />

  <style>
/* ===== MOBILE (<=480px) ===== */
@media (max-width: 480px){
  .wrap{padding:16px}
  .nav{gap:10px; padding:12px}
  .nav .tools{width:100%; display:grid; grid-template-columns:1fr 1fr; gap:8px}
  .nav .tools .btn{width:100%; min-height:44px; display:flex; align-items:center; justify-content:center}
  .nav .tools .btn.primary{grid-column:1 / -1}
  .hero{grid-template-columns:1fr; gap:14px}
  .grid.two{grid-template-columns:1fr}
  .tabs{display:grid; grid-template-columns:1fr 1fr; gap:8px}
  .tab{width:100%; text-align:center}
  .grid.pkg{grid-template-columns:repeat(2,minmax(0,1fr))}
  .grid.pkg .glass{display:grid; align-content:start; min-height:128px !important}
  .price{font-size:18px}
  .row{grid-template-columns:1fr; gap:10px}
  h1{font-size:22px}
  .nav .tools a[href="#packages"],
  .nav .tools a[href="#order"],
  .nav .tools a[href="#history"]{ display:none; }
}

/* ===== TABLE SCROLL ===== */
.table-scroll{overflow-x:auto; -webkit-overflow-scrolling:touch}
.table-scroll table{min-width:720px}

/* ===== THEME ===== */
:root{
  --bg:#0a0f0b; --bg2:#0f1a12;
  --glass:#0e1511cc; --panel:#0f1a12; --card:#101d15;
  --text:#f8fff6; --muted:#cde3cf; --muted2:#b8d2bb;
  --brand:#e53935; --brand2:#36c06b; --accent:#ffd166;
  --warn:#ff6b6b; --border:#203326; --shadow:0 20px 60px rgba(0,0,0,.55); --radius:18px;
}
*{box-sizing:border-box} html,body{height:100%}
body{
  margin:0; color:var(--text); font-family:system-ui,Segoe UI,Prompt,sans-serif;
  background:
    radial-gradient(1100px 600px at 0% 0%, #19301f 0%, transparent 60%),
    radial-gradient(900px 700px at 100% 0%, #2a1a1a 0%, transparent 60%),
    radial-gradient(900px 900px at 50% 120%, #112019 0%, transparent 60%),
    linear-gradient(180deg, var(--bg), var(--bg2));
}
/* ‡∏•‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
body::before{
  content:""; position:fixed; inset:0; z-index:-3; pointer-events:none;
  background:url("christmas-bg.png") center/cover no-repeat;
  opacity:.10; mix-blend-mode:screen;
}

/* ===== ‡∏´‡∏¥‡∏°‡∏∞‡∏ï‡∏Å‡πÅ‡∏ö‡∏ö 3 ‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡∏à‡∏£‡∏¥‡∏á ‡πÜ ===== */
.snow{position:fixed; inset:-120vh -20vw 0 -20vw; pointer-events:none; z-index:-2;
  background-repeat:repeat; will-change:background-position; mix-blend-mode:screen;}
.s1{
  background-image:
    radial-gradient(2px 2px at 20px 20px,#fff8 90%,transparent),
    radial-gradient(2px 2px at 120px 80px,#fff8 90%,transparent),
    radial-gradient(2px 2px at 80px 140px,#fff8 90%,transparent);
  background-size:220px 220px, 260px 260px, 300px 300px;
  animation:fall1 10s linear infinite;
  opacity:.9;
}
.s2{
  background-image:
    radial-gradient(3px 3px at 40px 60px,#fffd 90%,transparent),
    radial-gradient(3px 3px at 160px 40px,#fffd 90%,transparent),
    radial-gradient(3px 3px at 100px 180px,#fffd 90%,transparent);
  background-size:320px 320px, 380px 380px, 420px 420px;
  animation:fall2 18s linear infinite;
  filter:blur(.3px); opacity:.85;
}
.s3{
  background-image:
    radial-gradient(4px 4px at 60px 30px,#ffff 90%,transparent),
    radial-gradient(4px 4px at 200px 90px,#ffff 90%,transparent),
    radial-gradient(4px 4px at 140px 220px,#ffff 90%,transparent);
  background-size:480px 480px, 560px 560px, 640px 640px;
  animation:fall3 28s linear infinite;
  filter:blur(.6px); opacity:.7;
}
/* ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á + ‡πÄ‡∏≠‡∏µ‡∏¢‡∏á‡∏•‡∏° */
@keyframes fall1{ from{ background-position: 0 -120vh, -10vw -120vh, 8vw -120vh }
                   to  { background-position: 0 0,       -10vw 0,       8vw 0 } }
@keyframes fall2{ from{ background-position: -8vw -120vh, 6vw -120vh, 0 -120vh }
                   to  { background-position: -8vw 0,      6vw 0,      0 0 } }
@keyframes fall3{ from{ background-position: 10vw -120vh, -6vw -120vh, 4vw -120vh }
                   to  { background-position: 10vw 0,      -6vw 0,      4vw 0 } }
/* ‡∏•‡∏î‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô‡∏´‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ reduce motion */
@media (prefers-reduced-motion:reduce){
  .s1,.s2,.s3{animation:none}
}

/* ===== UI ===== */
a{color:var(--accent);text-decoration:none} img{max-width:100%;display:block}
.wrap{max-width:1100px;margin:auto;padding:20px}

.nav{
  display:flex;justify-content:space-between;align-items:center;gap:12px;
  background:linear-gradient(180deg,#132017,#0e1812);
  border:1px solid var(--border);border-radius:20px;padding:10px 14px;
  box-shadow:var(--shadow);backdrop-filter: blur(8px);position:sticky;top:12px;z-index:10
}
.brand{display:flex;gap:12px;align-items:center}
.logo{
  width:42px;height:42px;border-radius:12px;
  background:conic-gradient(from 220deg,#e53935,#36c06b,#ffd166,#e53935);
  display:grid;place-items:center;font-weight:900;color:#1b0d0d;box-shadow:0 0 18px #ffd16640
}
.site-badge{
  font-size:12px;color:#ffe6a8;background:#182416;border:1px solid #274426;
  padding:3px 8px;border-radius:999px;display:inline-flex;gap:6px;align-items:center
}
.btn{padding:9px 14px;border-radius:12px;border:1px solid var(--border);background:linear-gradient(180deg,#14241a,#0f1b14);color:#f2fff2;font-weight:700;cursor:pointer}
.btn[disabled]{opacity:.6;pointer-events:none}
.btn.primary{
  background:linear-gradient(90deg,var(--brand),var(--brand2));
  color:#1b0d0d;border:none;
  box-shadow:0 0 10px #ffd16650,0 0 28px #36c06b40;text-shadow:0 0 6px rgba(255,230,170,.6)
}

.hero{margin-top:16px;display:grid;grid-template-columns:2fr 1fr;gap:18px}
.glass{
  background:linear-gradient(180deg,var(--glass),#0e1712cc);
  border:1px solid var(--border);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);backdrop-filter: blur(10px)
}
.badge{padding:6px 10px;border-radius:999px;background:#1b2a1e;border:1px solid var(--border);display:inline-flex;gap:8px;align-items:center}

/* ===== ‡πÄ‡∏Æ‡∏î‡∏î‡∏¥‡πâ‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡πÅ‡∏™‡∏á‡πÅ‡∏ö‡∏ö‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô ===== */
.drip{letter-spacing:.2px}
.glow{
  text-shadow:
    0 0 6px rgba(255,209,102,.55),
    0 0 14px rgba(255,209,102,.45),
    0 0 28px rgba(54,192,107,.35);
  animation:glowPulse 2.6s ease-in-out infinite alternate;
}
@keyframes glowPulse{
  from{
    text-shadow:
      0 0 6px rgba(255,209,102,.55),
      0 0 16px rgba(255,209,102,.45),
      0 0 28px rgba(54,192,107,.30);
    filter:saturate(1);
  }
  to{
    text-shadow:
      0 0 10px rgba(255,209,102,.9),
      0 0 24px rgba(255,209,102,.75),
      0 0 48px rgba(54,192,107,.55);
    filter:saturate(1.15);
  }
}

.statgrid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px}
.stat{background:#16281d;border:1px solid var(--border);border-radius:14px;text-align:center;padding:14px}
.muted{color:var(--muted)} .muted2{color:var(--muted2)}
.section{margin-top:22px}
.grid{display:grid;gap:16px}
.grid.pkg{grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
.grid.two{grid-template-columns:2fr 1fr}
.card{background:#102219;border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
label{display:block;margin-bottom:6px;color:#d6f0d8}
input,select,textarea{width:100%;background:#0f1a13;border:1px solid var(--border);color:#fff;padding:12px;border-radius:12px}
.price{font-size:22px;font-weight:900}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.summary{position:sticky;top:84px}
.list{display:flex;flex-direction:column;gap:8px}
.item{display:flex;justify-content:space-between;gap:10px}
.total{font-size:22px;font-weight:900}
.tabs{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 0}
.tab{padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:#132319;cursor:pointer}
.tab.active{
  background:linear-gradient(90deg,var(--brand),var(--brand2));color:#1b0d0d;border:none;box-shadow:0 0 10px #ffd16650
}
.neon{box-shadow:0 0 12px rgba(255,209,102,.25),0 0 24px rgba(54,192,107,.18),inset 0 0 0 1px rgba(255,209,102,.18);border:1px solid rgba(255,209,102,.25);border-radius:14px;padding:12px;margin-top:10px}
.neon h3{margin:0 0 6px;font-size:16px;text-shadow:0 0 12px rgba(255,209,102,.35)}
.mini-sum .row-line{display:flex;justify-content:space-between;gap:10px;padding:4px 0;border-bottom:1px dashed rgba(255,255,255,.06)}
.mini-sum .row-line:last-child{border-bottom:0}
.ribbon{
  position:absolute;right:14px;top:-10px;rotate:8deg;
  background:linear-gradient(90deg,#e53935,#36c06b);
  color:#1b0d0d;padding:6px 12px;border-radius:8px;font-weight:900;
  box-shadow:0 6px 18px #36c06b60;border:1px solid #5c2a00
}
@media (max-width:980px){.hero{grid-template-columns:1fr}.grid.two{grid-template-columns:1fr}.summary{position:static}}

/* ===== AUTH ===== */
.auth{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);backdrop-filter:blur(6px);z-index:50}
.auth.hide{display:none}
.panel{width:min(520px,92vw);background:#0e1813;border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);padding:20px}
.pair{display:grid;grid-template-columns:140px 1fr;gap:8px;align-items:center;margin:8px 0}
.note{font-size:12px;color:#cde3cf}

/* ===== HISTORY ===== */
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.06);text-align:left}
th{color:#ffe6a8}
.tools{display:flex;gap:8px;flex-wrap:wrap}
.pill{display:inline-flex;gap:6px;align-items:center;padding:4px 8px;border:1px solid var(--border);border-radius:999px;background:#132319}

/* ===== ‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ï‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏ß‡∏≤ ===== */
.hero-cta{display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:10px; width:100%; margin-top:12px}
.hero-cta .btn{width:100%; text-align:center}
@media (max-width:480px){ .hero-cta{ grid-template-columns:1fr } }

/* ===== COUNTDOWN STRIP ===== */
.countdown-strip{
  margin-top:10px;
  background:linear-gradient(90deg, #213726, #182b20);
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px 12px;
  display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;
}
.cd-label{font-weight:800; letter-spacing:.3px}
.cd-digits{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-weight:900}
  </style>
</head>
<body>

<!-- ‡∏´‡∏¥‡∏°‡∏∞ 3 ‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå -->
<div class="snow s1"></div>
<div class="snow s2"></div>
<div class="snow s3"></div>

<!-- AUTH -->
<div class="auth" id="auth">
  <div class="panel">
    <h2 id="authTitle">üîí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</h2>
    <p id="authDesc" class="muted2">‡∏ï‡∏±‡πâ‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ + PIN (‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ)</p>

    <div id="setupForm">
      <div class="pair"><label>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label><input id="setupUser" placeholder="‡πÄ‡∏ä‡πà‡∏ô evan" /></div>
      <div class="pair"><label>PIN</label><input id="setupPin" type="password" inputmode="numeric" maxlength="6" placeholder="4‚Äì6 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç" /></div>
      <div class="pair"><label>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô PIN</label><input id="setupPin2" type="password" inputmode="numeric" maxlength="6" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ã‡πâ‡∏≥" /></div>
      <div class="pair"><label>‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏ö‡∏¥‡∏•</label><input id="setupName" placeholder="‡πÄ‡∏ä‡πà‡∏ô Ryu" /></div>
      <div class="pair"><label>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label><input id="setupContact" placeholder="Line/FB/Tel" /></div>
      <div class="tools"><button class="btn primary" id="btnSetup" type="button">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button></div>
      <div class="note">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô LocalStorage ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ</div>
    </div>

    <div id="loginForm" style="display:none">
      <div class="pair"><label>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label><input id="loginUser" placeholder="‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" /></div>
      <div class="pair"><label>PIN</label><input id="loginPin" type="password" inputmode="numeric" maxlength="6" placeholder="PIN" /></div>
      <div class="tools">
        <button class="btn primary" id="btnLogin" type="button">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</button>
        <button class="btn" id="btnForgot" type="button">‡∏•‡∏∑‡∏° PIN</button>
      </div>
      <div class="note">‡∏•‡∏∑‡∏° PIN ‚Üí ‡πÉ‡∏ä‡πâ ‚Äú‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‚Äù ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‚Äú‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‚Äù</div>
    </div>
  </div>
</div>

<div class="wrap">
  <!-- NAV -->
  <nav class="nav">
    <div class="brand">
      <div class="logo">EV</div>
      <div>
        <div style="font-weight:900;letter-spacing:.5px">EVAN VALE</div>
        <div class="site-badge">üéÑ Christmas Event ‚Ä¢ ‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏ß ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</div>
      </div>
    </div>
    <div class="tools">
      <a class="btn" href="#packages">‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à</a>
      <a class="btn" href="#order">‡∏™‡∏±‡πà‡∏á‡πÄ‡∏ï‡∏¥‡∏°</a>
      <a class="btn" href="#history">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</a>
      <a class="btn primary" id="btnAdminNav" href="https://www.facebook.com/share/1JRkDmJDvX/" target="_blank" rel="noopener">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</a>
      <button class="btn" id="btnLogout" style="display:none" type="button">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
  </nav>

  <!-- HERO -->
  <section class="hero">
    <div class="glass" style="position:relative">
      <span class="ribbon" id="ribbonTxt">CHRISTMAS üéÑ</span>
      <span class="badge">‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå 08:30‚Äì21:30</span>
      <h1 class="drip glow">EVAN VALE ‚Äî ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏î‡∏µ ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ <span style="color:var(--accent)">‡∏°‡∏µ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏î‡∏π‡πÅ‡∏•</span></h1>

      <div class="countdown-strip" id="cdStrip" aria-live="polite">
        <div class="cd-label">‚è≥ ‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏™‡∏π‡πà‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà</div>
        <div class="cd-digits" id="countdownDigits">-- ‡∏ß‡∏±‡∏ô --:--:--</div>
      </div>

      <div class="statgrid">
        <div class="stat"><div style="font-size:20px;font-weight:900">3‚Äì10 ‡∏ô‡∏≤‡∏ó‡∏µ*</div><div class="muted2">‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div></div>
        <div class="stat"><div style="font-size:20px;font-weight:900">1000+</div><div class="muted2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div></div>
        <div class="stat"><div style="font-size:20px;font-weight:900">0%</div><div class="muted2">‡∏¢‡∏∂‡∏î UID</div></div>
      </div>
      <p class="muted2" style="margin-top:8px">*‡∏ä‡πà‡∏ß‡∏á‡∏û‡∏µ‡∏Ñ/‡πÄ‡∏Å‡∏°‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏≠‡∏≤‡∏à‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥</p>
    </div>

    <div class="glass" style="display:grid;place-items:center;text-align:center">
      <div style="font-weight:800">‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏≠‡∏ö‡πÑ‡∏ß</div>
      <div class="muted2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</div>
      <div class="hero-cta">
        <a class="btn" href="#packages">‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à</a>
        <a class="btn primary" href="#order">‡∏™‡∏±‡πà‡∏á‡πÄ‡∏ï‡∏¥‡∏°</a>
        <a class="btn" href="#history">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</a>
      </div>
    </div>
  </section>

  <!-- PACKAGES -->
  <section id="packages" class="section">
    <div class="card">
      <h2 style="margin:0">‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à‡∏¢‡∏≠‡∏î‡∏Æ‡∏¥‡∏ï</h2>
      <div class="tabs" id="game-tabs"></div>
      <p class="muted2" style="margin:6px 0 10px">‡∏Ñ‡∏•‡∏¥‡∏Å ‚Äú‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Å‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
      <div class="grid pkg" id="pkg-grid"></div>
    </div>
  </section>

  <!-- ORDER -->
  <section id="order" class="section grid two" style="align-items:start">
    <div class="card">
      <h2 style="margin-top:0">‡∏™‡∏±‡πà‡∏á‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏°</h2>

      <div class="row">
        <div>
          <label>‡πÄ‡∏Å‡∏°</label>
          <select id="game"></select>
          <p id="gameNote" style="display:none;color:#ffd166;font-size:14px;margin:6px 0 0"></p>
          <p id="thaiOnlyNote" style="display:none;color:#ffd166;font-size:14px;margin:6px 0 0;background:#142318;padding:6px 10px;border-radius:6px;border-left:3px solid var(--brand);">
            ‚ö†Ô∏è ‡πÄ‡∏Å‡∏°‡∏ô‡∏µ‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ <b>‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏ó‡∏¢</b> ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (Free Fire / RoV / PUBG Mobile / Roblox / Call of Duty)
          </p>
          <div class="neon mini-sum" id="miniSum" style="display:none">
            <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏£‡πà‡∏≤‡∏ß‡πÜ</h3>
            <div class="row-line"><span class="label">‡πÄ‡∏Å‡∏°</span><span class="value" id="mini-game">-</span></div>
            <div class="row-line"><span class="label">‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</span><span class="value" id="mini-server">-</span></div>
            <div class="row-line"><span class="label">‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à</span><span class="value" id="mini-pkg">-</span></div>
            <div class="row-line"><span class="label">‡∏¢‡∏≠‡∏î</span><span class="value" id="mini-total">‡∏ø0</span></div>
          </div>
        </div>
        <div>
          <label>‡πÇ‡∏ã‡∏ô/‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</label>
          <select id="server"></select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>UID / Player ID</label>
          <input id="uid" placeholder="‡πÄ‡∏ä‡πà‡∏ô 812345678 ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡πÄ‡∏Å‡∏°">
        </div>
        <div>
          <label>‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à</label>
          <select id="package"></select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞</label>
          <select id="method">
            <option>PromptPay</option>
            <option>TrueMoney Wallet</option>
            <option>‡πÇ‡∏≠‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</option>
          </select>
        </div>
        <div>
          <label>‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
          <input id="promo" placeholder="‡πÄ‡∏ä‡πà‡∏ô EVAN10">
        </div>
      </div>

      <div class="row">
        <div>
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
          <input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ">
        </div>
        <div>
          <label>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label>
          <input id="contact" placeholder="Line/FB/Tel">
        </div>
      </div>

      <div class="tools" style="margin-top:12px">
        <button class="btn" id="btnReset" type="button">‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
        <button class="btn primary" id="btnSubmit" type="button" disabled>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏¥‡∏•</button>
        <button class="btn" id="btnSaveProfile" type="button" disabled>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</button>
      </div>
      <p class="muted2" style="margin-top:8px">‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏™‡πà‡∏ß‡∏ô ‚Äú‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‚Äù ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
    </div>

    <aside class="card summary">
      <h3 style="margin-top:0">‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏•</h3>
      <div class="list">
        <div class="item"><span class="muted2">‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•</span><span id="sum-bill">-</span></div>
        <div class="item"><span class="muted2">‡πÄ‡∏Å‡∏°</span><span id="sum-game">-</span></div>
        <div class="item"><span class="muted2">‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</span><span id="sum-server">-</span></div>
        <div class="item"><span class="muted2">UID</span><span id="sum-uid">-</span></div>
        <div class="item"><span class="muted2">‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à</span><span id="sum-pkg">-</span></div>
        <div class="item"><span class="muted2">‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞</span><span id="sum-method">-</span></div>
      </div>
      <div style="height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.12),transparent);margin:10px 0"></div>
      <div class="item"><span class="muted2">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span><span class="total" id="sum-total">‡∏ø0</span></div>
    </aside>
  </section>

  <!-- PAYMENT -->
  <section id="pay" class="section" style="display:none">
    <div class="card">
      <h2 style="margin-top:0">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
      <p class="muted2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á ‚Ä¢ ‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ/‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á ‚Ä¢ ‚Äú‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏•‚Äù ‡πÅ‡∏•‡πâ‡∏ß ‚Äú‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‚Äù</p>
      <div class="grid pkg">
        <div class="glass" style="text-align:center">
          <div style="font-weight:800;margin-bottom:8px">TrueMoney Wallet</div>
          <img src="truemoney.png" alt="TrueMoney QR" style="border-radius:12px">
          <div class="muted2" style="margin-top:6px">‡∏™‡πÅ‡∏Å‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏≠‡∏õ TrueMoney</div>
        </div>
        <div class="glass" style="text-align:center">
          <div style="font-weight:800;margin-bottom:8px">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå / ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</div>
          <img src="promptpay.png" alt="PromptPay QR" style="border-radius:12px">
          <div class="muted2" style="margin-top:6px">‡∏™‡πÅ‡∏Å‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏≠‡∏õ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</div>
        </div>
      </div>

      <div class="glass" style="margin-top:14px">
        <h3 style="margin-top:0">‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</h3>
        <div class="row">
          <div>
            <label>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ</label>
            <input id="slip" type="file" accept="image/*">
            <div class="muted2" style="margin-top:6px">‡πÄ‡∏ß‡πá‡∏ö‡∏™‡πÅ‡∏ï‡∏ï‡∏¥‡∏Å‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå ‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡∏ö‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡πÅ‡∏ä‡∏ó‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ</div>
          </div>
          <div>
            <label>‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
            <input id="ref" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2025-XX-XX">
          </div>
        </div>

        <div class="tools" style="margin-top:12px">
          <button class="btn" id="btnBackToForm" type="button">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
          <button class="btn primary" id="btnPrepareMsg" type="button" disabled>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏•</button>
          <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß -->
          <button class="btn" id="btnMarkPaid" type="button" disabled>‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</button>
          <a class="btn" id="btnOpenAdmin" href="#" target="_blank" rel="noopener" style="pointer-events:none;opacity:.6">‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</a>
        </div>

        <div id="copyHint" class="muted2" style="display:none;margin-top:8px">‚úîÔ∏è ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡∏ñ‡πâ‡∏≤‡πÅ‡∏ä‡∏ó‡πÑ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á ‡πÉ‡∏´‡πâ ‚Äú‡∏ß‡∏≤‡∏á (Paste)‚Äù ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</div>
        <textarea id="msgPreview" readonly style="display:none;width:100%;margin-top:8px;background:#0f1a13;color:#f8fff6;border:1px solid #203326;border-radius:10px;padding:10px" rows="8"></textarea>
      </div>
    </div>
  </section>

  <!-- HISTORY -->
  <section id="history" class="section">
    <div class="card">
      <h2 style="margin:0">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h2>
      <div class="tools" style="margin:10px 0">
        <input id="histSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: ‡∏ö‡∏¥‡∏•/‡πÄ‡∏Å‡∏°/UID/‡∏ä‡∏∑‡πà‡∏≠" style="max-width:260px">
        <select id="histGameFilter" class="pill">
          <option value="">‡∏ó‡∏∏‡∏Å‡πÄ‡∏Å‡∏°</option>
        </select>
        <select id="histStatusFilter" class="pill">
          <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
          <option>‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞</option>
          <option>‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡πâ‡∏ß</option>
          <option>‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</option>
          <option>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
        </select>
        <button class="btn" id="btnExportCsv" type="button">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV</button>
        <button class="btn" id="btnClearAll" type="button">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      </div>

      <div class="glass table-scroll">
        <table id="histTable">
          <thead>
            <tr>
              <th>‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•</th><th>‡πÄ‡∏Å‡∏°</th><th>‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü</th><th>‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à</th><th>‡∏¢‡∏≠‡∏î</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>UID</th><th>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div id="histEmpty" class="muted2" style="padding:8px 0;display:none">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
      </div>
    </div>
  </section>

  <div class="footer">¬© 2025 Evan Vale ‚Ä¢ Christmas Event</div>
</div>

<script>
/* ===== AUTH / SESSION ===== */
const KEY_USER="ev_auth_user";
const KEY_SESSION="ev_auth_session";
function ordersKey(){ const u=userBox(); return u? `ev_orders_${u.user}` : "ev_orders__guest"; }

// ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏ì‡∏µ crypto.subtle ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ö‡∏ö file:// ‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏£‡∏≤‡∏ß‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πà‡∏≤)
async function sha256(str){
  const enc=new TextEncoder().encode(str);
  const buf=await crypto.subtle.digest('SHA-256',enc);
  return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,'0')).join('');
}
function simpleHash(s){
  let h=2166136261>>>0;
  for(let i=0;i<s.length;i++){ h^=s.charCodeAt(i); h=(h*16777619)>>>0; }
  return 'fhv1-'+h.toString(16);
}
async function hashSafe(str){
  try{
    if(!crypto?.subtle) throw new Error('no subtle');
    return await sha256(str);
  }catch{
    return simpleHash(str);
  }
}
function userBox(){ try{ return JSON.parse(localStorage.getItem(KEY_USER)||"null"); }catch{return null;} }
function setUserBox(v){ localStorage.setItem(KEY_USER, JSON.stringify(v)); }
function setSession(on){ if(on){ sessionStorage.setItem(KEY_SESSION,"ok"); } else { sessionStorage.removeItem(KEY_SESSION); } }
function isLogged(){ return sessionStorage.getItem(KEY_SESSION)==="ok"; }
function showAuth(show){ document.getElementById('auth').classList.toggle('hide', !show); }
function toggleProtected(disabled){
  document.getElementById('btnSubmit').disabled      = disabled;
  document.getElementById('btnPrepareMsg').disabled  = disabled;
  document.getElementById('btnSaveProfile').disabled = disabled;
  document.getElementById('btnLogout').style.display = disabled ? "none" : "inline-block";
}

/* ===== DATA ===== */
const ADMIN_URL = "https://www.facebook.com/share/1JRkDmJDvX/";
const GAMES = [
  { key:"Free Fire", icon:"üî•", servers:["Thailand","SEA","Global","‡∏≠‡∏∑‡πà‡∏ô‡πÜ"] },
  { key:"RoV", icon:"üõ°Ô∏è", servers:["Thailand","Vietnam","Taiwan","‡∏≠‡∏∑‡πà‡∏ô‡πÜ"] },
  { key:"Genshin Impact", icon:"‚ú®", servers:["‡πÄ‡∏≠‡πÄ‡∏ä‡∏µ‡∏¢ (Asia)","‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤ (America)","‡∏¢‡∏∏‡πÇ‡∏£‡∏õ (Europe)","TW, HK, MO","‡∏≠‡∏∑‡πà‡∏ô‡πÜ"] },
  { key:"Honkai: Star Rail", icon:"üöÑ", servers:["‡πÄ‡∏≠‡πÄ‡∏ä‡∏µ‡∏¢ (Asia)","‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤ (America)","‡∏¢‡∏∏‡πÇ‡∏£‡∏õ (Europe)","TW, HK, MO","‡∏≠‡∏∑‡πà‡∏ô‡πÜ"] },
  { key:"PUBG Mobile", icon:"üéØ", servers:["Thailand","SEA","KRJP","Global","‡∏≠‡∏∑‡πà‡∏ô‡πÜ"] },
  { key:"Roblox", icon:"üß±", servers:["Thailand","Asia","USA","Global","‡∏≠‡∏∑‡πà‡∏ô‡πÜ"] },
  { key:"Roblox (‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô)", icon:"üéÅ", servers:["Thailand","Asia","USA","Global","‡∏≠‡∏∑‡πà‡∏ô‡πÜ"] },
  { key:"Call of Duty", icon:"üéÆ", servers:["Thailand","SEA","Global","‡∏≠‡∏∑‡πà‡∏ô‡πÜ"] },
  { key:"Wuthering Waves", icon:"üåä", servers:["‡πÄ‡∏≠‡πÄ‡∏ä‡∏µ‡∏¢ (Asia)","‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤ (America)","‡∏¢‡∏∏‡πÇ‡∏£‡∏õ (Europe)","TW, HK, MO","‡∏≠‡∏∑‡πà‡∏ô‡πÜ"] },
];
const PACKS_BY_GAME = {
  "Free Fire":[{name:"33 ‡πÄ‡∏û‡∏ä‡∏£",price:11},{name:"68 ‡πÄ‡∏û‡∏ä‡∏£",price:21},{name:"172 ‡πÄ‡∏û‡∏ä‡∏£",price:49},{name:"310 ‡πÄ‡∏û‡∏ä‡∏£",price:87},{name:"517 ‡πÄ‡∏û‡∏ä‡∏£",price:145},{name:"690 ‡πÄ‡∏û‡∏ä‡∏£",price:195},{name:"1052 ‡πÄ‡∏û‡∏ä‡∏£",price:290},{name:"1800 ‡πÄ‡∏û‡∏ä‡∏£",price:480},{name:"3698 ‡πÄ‡∏û‡∏ä‡∏£",price:950},{name:"7396 ‡πÄ‡∏û‡∏ä‡∏£",price:1900},{name:"‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏î‡∏≤‡∏°‡∏¥‡∏ô‡∏¥",price:32},{name:"‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏î‡∏≤",price:63},{name:"‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô",price:287},{name:"‡∏ö‡∏π‡∏¢‡πà‡∏≤‡∏´‡πå‡∏û‡∏≤‡∏™",price:90},{name:"‡∏≠‡∏µ‡πÇ‡∏ß‡∏û‡∏≤‡∏™ 3 ‡∏ß‡∏±‡∏ô",price:46},{name:"‡∏≠‡∏µ‡πÇ‡∏ß‡∏û‡∏≤‡∏™ 7 ‡∏ß‡∏±‡∏ô",price:62},{name:"‡∏≠‡∏µ‡πÇ‡∏ß‡∏û‡∏≤‡∏™ 30 ‡∏ß‡∏±‡∏ô",price:220}],
  "RoV":[{name:"11 ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á",price:10},{name:"24 ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á",price:19},{name:"60 ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á",price:49},{name:"110 ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á",price:87},{name:"185 ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á",price:144},{name:"370 ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á",price:285},{name:"620 ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á",price:478},{name:"990 ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á",price:765},{name:"1250 ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á",price:960}],
  "Genshin Impact":[{name:"60 Genesis Crystals",price:30},{name:"300+30 Genesis Crystals",price:145},{name:"980+110 Genesis Crystals",price:420},{name:"1980+260 Genesis Crystals",price:870},{name:"3280+600 Genesis Crystals",price:1340},{name:"6480+1600 Genesis Crystals",price:2625},{name:"Blessing (‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)",price:179}],
  "Honkai: Star Rail":[{name:"60 Oneiric Shard",price:35},{name:"300+30 Shard",price:145},{name:"980+110 Shard",price:425},{name:"1980+260 Shard",price:870},{name:"3280+600 Shard",price:1340},{name:"6480+1600 Shard",price:2630},{name:"Express Supply Pass",price:145}],
  "PUBG Mobile":[{name:"60 UC",price:35},{name:"325 UC",price:179},{name:"660 UC",price:346},{name:"1800 UC",price:860},{name:"3850 UC",price:1696},{name:"8100 UC",price:3305},{name:"16200 UC",price:6475},{name:"24300 UC",price:9910}],
  "Roblox":[{name:"80 Robux",price:35},{name:"160 Robux",price:70},{name:"400 Robux",price:175},{name:"800 Robux",price:350},{name:"1000 Robux",price:400},{name:"2000 Robux",price:600},{name:"4000 Robux",price:1200},{name:"‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô 1000 Robux",price:380}],
  "Roblox (‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô)":[{name:"500 Robux (‡∏à‡∏≤‡∏Å 230 ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 160)",price:160},{name:"3000 Robux (‡∏à‡∏≤‡∏Å 1000 ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 860)",price:860}],
  "Call of Duty":[{name:"44 ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 10 CP",price:22},{name:"108 ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 30 CP",price:52},{name:"194 ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 55 CP",price:90},{name:"324 ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 90 CP",price:152},{name:"648 ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 216 CP",price:305},{name:"1080 ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 480 CP",price:505},{name:"2160 ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 1080 CP",price:1010}],
  "Wuthering Waves":[{name:"60 Lunite",price:35},{name:"300+30 Lunite",price:179},{name:"980+110 Lunite",price:549},{name:"Lunite Pass (‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)",price:179}]
};

/* ===== REFS ===== */
const tabs = document.getElementById('game-tabs');
const pkgGrid = document.getElementById('pkg-grid');
const selGame = document.getElementById('game');
const selServer = document.getElementById('server');
const selPackage = document.getElementById('package');
const miniSum = document.getElementById('miniSum');
const miniGame = document.getElementById('mini-game');
const miniServer = document.getElementById('mini-server');
const miniPkg = document.getElementById('mini-pkg');
const miniTotal = document.getElementById('mini-total');
const gameNote = document.getElementById('gameNote');
const thaiOnlyNote = document.getElementById('thaiOnlyNote');
const btnLogout = document.getElementById('btnLogout');

let currentGame = GAMES[0].key;
const thaiOnlyGames = ["Free Fire","RoV","PUBG Mobile","Roblox","Call of Duty"];

/* ===== UI: Packages ===== */
function renderGameTabs(){
  tabs.innerHTML = ""; selGame.innerHTML = "";
  GAMES.forEach(g=>{
    const t = document.createElement('div');
    t.className = 'tab' + (g.key===currentGame?' active':'');
    t.textContent = `${g.icon} ${g.key}`;
    t.addEventListener('click', ()=> setGame(g.key));
    tabs.appendChild(t);
    const opt = document.createElement('option');
    opt.value = g.key; opt.textContent = g.key;
    selGame.appendChild(opt);
  });
  selGame.value = currentGame;
}
function renderServers(){
  selServer.innerHTML = "";
  const gs = GAMES.find(x=>x.key===currentGame)?.servers || ["Global"];
  gs.forEach(s=>{
    const o=document.createElement('option'); o.value=s; o.textContent=s;
    selServer.appendChild(o);
  });
}
function renderPacks(){
  const packs = PACKS_BY_GAME[currentGame]||[];
  pkgGrid.innerHTML = "";
  selPackage.innerHTML = "<option value='' disabled selected>‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à ‚Äî</option>";
  packs.forEach(p=>{
    const card = document.createElement('div');
    card.className = "glass";
    card.innerHTML = `
      <div style="font-weight:800">${p.name}</div>
      <div class="price">‡∏ø${p.price}</div>
      <div style="margin-top:10px">
        <a href="#order" class="btn primary" data-pkg="${p.name} ‚Äì ‡∏ø${p.price}">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Å</a>
      </div>`;
    pkgGrid.appendChild(card);
    const opt = document.createElement('option');
    opt.value = `${p.name} ‚Äì ‡∏ø${p.price}`;
    opt.textContent = `${p.name} ‚Äì ‡∏ø${p.price}`;
    selPackage.appendChild(opt);
  });
  pkgGrid.querySelectorAll('a[data-pkg]').forEach(a=>{
    a.addEventListener('click',e=>{
      e.preventDefault();
      selPackage.value = a.getAttribute('data-pkg');
      document.getElementById('order').scrollIntoView({behavior:'smooth'});
      updateSummary();
    });
  });
}
function setGame(game){
  currentGame = game;
  [...tabs.children].forEach(el=> el.classList.toggle('active', el.textContent.includes(game)));
  if (currentGame === "Roblox"){
    gameNote.style.display = "block"; gameNote.textContent = "‚ÑπÔ∏è Roblox: ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡∏≤‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏°‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡∏•‡∏≤)";
  } else if (currentGame === "Call of Duty"){
    gameNote.style.display = "block"; gameNote.textContent = "‚ö†Ô∏è COD: ‡∏ñ‡πâ‡∏≤ ID ‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö Garena ‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÑ‡∏ó‡∏¢)";
  } else { gameNote.style.display="none"; gameNote.textContent=""; }
  thaiOnlyNote.style.display = thaiOnlyGames.includes(currentGame) ? "block" : "none";
  selGame.value = game;
  renderServers(); renderPacks(); updateSummary(); showMini();
}
function showMini(){
  const has = (selPackage.value||"").length>0 || (document.getElementById('uid').value||"").length>0;
  miniSum.style.display = has ? "block" : "none";
}

/* ===== SUMMARY / BILL ===== */
const pad = n => n.toString().padStart(2,'0');
function genInvoice(){
  const d = new Date();
  const ts = `${d.getFullYear()}${pad(d.getMonth()+1)}${pad(d.getDate())}-${pad(d.getHours())}${pad(d.getMinutes())}${pad(d.getSeconds())}`;
  const rnd = Math.floor(Math.random()*8999)+1000;
  return `EV-${ts}-${rnd}`;
}
function money(n){ return "‡∏ø"+(n||0); }
function updateSummary(){
  const g = selGame.value;
  const s = selServer.value;
  const u = document.getElementById('uid').value || "-";
  const p = selPackage.value || "-";
  const m = document.getElementById('method').value;

  document.getElementById('sum-game').innerText   = g;
  document.getElementById('sum-server').innerText = s || "-";
  document.getElementById('sum-uid').innerText    = u;
  document.getElementById('sum-pkg').innerText    = p;
  document.getElementById('sum-method').innerText = m;

  const price = Number((p.split("‡∏ø")[1] || "0").replace(/[^\d]/g,""));
  const totalTxt = money(price);
  document.getElementById('sum-total').innerText = totalTxt;

  miniGame.textContent  = g;
  miniServer.textContent= s || "-";
  miniPkg.textContent   = p;
  miniTotal.textContent = totalTxt;

  showMini();
}
["game","server","uid","package","method","name","contact","promo"].forEach(id=>{
  const el = document.getElementById(id);
  el.addEventListener('input', updateSummary);
  el.addEventListener('change', updateSummary);
});

/* ===== HISTORY ===== */
function loadOrders(){ try{ return JSON.parse(localStorage.getItem(ordersKey())||"[]"); }catch{return [];} }
function saveOrders(list){ localStorage.setItem(ordersKey(), JSON.stringify(list)); }
function addOrder(row){ const list=loadOrders(); list.unshift(row); saveOrders(list); renderHistory(); }
function updateOrderStatus(inv, status){
  const list=loadOrders(); const idx=list.findIndex(x=>x.invoiceId===inv);
  if(idx>-1){ list[idx].status=status; saveOrders(list); renderHistory(); }
}
function deleteOrder(inv){
  const list=loadOrders().filter(x=>x.invoiceId!==inv);
  saveOrders(list); renderHistory();
}
function clearAll(){
  if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ? (‡∏£‡∏ß‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ/‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥)')){
    localStorage.removeItem(KEY_USER);
    sessionStorage.removeItem(KEY_SESSION);
    localStorage.removeItem(ordersKey());
    location.reload();
  }
}
const histTableBody = document.querySelector('#histTable tbody');
const histEmpty = document.getElementById('histEmpty');
const histSearch = document.getElementById('histSearch');
const histGameFilter = document.getElementById('histGameFilter');
const histStatusFilter = document.getElementById('histStatusFilter');

function initHistoryFilters(){
  histGameFilter.innerHTML = '<option value="">‡∏ó‡∏∏‡∏Å‡πÄ‡∏Å‡∏°</option>' + GAMES.map(g=>`<option>${g.key}</option>`).join('');
  [histSearch,histGameFilter,histStatusFilter].forEach(el=>{
    el.addEventListener('input', renderHistory);
    el.addEventListener('change', renderHistory);
  });
}
function renderHistory(){
  const q = (histSearch.value||"").toLowerCase();
  const g = histGameFilter.value||"";
  const st= histStatusFilter.value||"";
  const list = loadOrders().filter(x=>{
    const inTxt = (x.invoiceId+x.game+x.uid+(x.name||"")+(x.package||"")).toLowerCase().includes(q);
    const gOk = g? x.game===g : true;
    const sOk = st? x.status===st : true;
    return inTxt && gOk && sOk;
  });
  histTableBody.innerHTML = "";
  histEmpty.style.display = list.length? "none":"block";
  list.forEach(x=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${new Date(x.ts).toLocaleString()}</td>
      <td>${x.invoiceId}</td>
      <td>${x.game}</td>
      <td>${x.server||"-"}</td>
      <td>${x.package||"-"}</td>
      <td>${x.total||"‡∏ø0"}</td>
      <td>
        <select data-inv="${x.invoiceId}">
          ${["‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞","‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡πâ‡∏ß","‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß","‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"].map(s=>`<option ${x.status===s?"selected":""}>${s}</option>`).join('')}
        </select>
      </td>
      <td>${x.uid||"-"}</td>
      <td>
        <button class="btn" data-view="${x.invoiceId}" type="button">‡∏î‡∏π</button>
        <button class="btn" data-del="${x.invoiceId}" type="button">‡∏•‡∏ö</button>
      </td>`;
    histTableBody.appendChild(tr);
  });
  histTableBody.querySelectorAll('button[data-del]').forEach(b=>{
    b.onclick = ()=> deleteOrder(b.getAttribute('data-del'));
  });
  histTableBody.querySelectorAll('button[data-view]').forEach(b=>{
    b.onclick = ()=>{
      const inv = b.getAttribute('data-view');
      const x = loadOrders().find(o=>o.invoiceId===inv);
      if(!x) return;
      alert(
`‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•: ${x.invoiceId}
‡πÄ‡∏ß‡∏•‡∏≤: ${new Date(x.ts).toLocaleString()}
‡πÄ‡∏Å‡∏°: ${x.game}
‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå: ${x.server||"-"}
‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à: ${x.package||"-"}
‡∏¢‡∏≠‡∏î: ${x.total||"‡∏ø0"}
‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞: ${x.method}
UID: ${x.uid||"-"}
‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${x.name||"-"} | ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠: ${x.contact||"-"}
‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${x.status}`);
    };
  });
  histTableBody.querySelectorAll('select[data-inv]').forEach(s=>{
    s.onchange = ()=> updateOrderStatus(s.getAttribute('data-inv'), s.value);
  });
}

/* ===== MESSAGE / COPY ===== */
function buildMessage(){
  const g = selGame.value, s = selServer.value, u = document.getElementById('uid').value || "-";
  const p = selPackage.value || "-", m = document.getElementById('method').value;
  const name = document.getElementById('name').value || "-", contact = document.getElementById('contact').value || "-";
  const total = document.getElementById('sum-total').innerText || "‡∏ø0";
  const ref = (document.getElementById('ref')?.value || "").trim();
  return `‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏° Evan Vale
‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•: ${window.invoiceId}
‡πÄ‡∏Å‡∏°: ${g}
‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå/‡πÇ‡∏ã‡∏ô: ${s || "-"}
UID/Player ID: ${u}
‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à: ${p}
‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞: ${m}
‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${total}
‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${name}
‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠: ${contact}
‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á: ${ref||"-"}
‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö`;
}
const btnPrepare   = document.getElementById('btnPrepareMsg');
const btnOpenAdmin = document.getElementById('btnOpenAdmin');
const msgPreview   = document.getElementById('msgPreview');
const copyHint     = document.getElementById('copyHint');
function makeAdminUrl(){ return ADMIN_URL; }
async function copyTextSafe(text){
  try{ await navigator.clipboard.writeText(text); return true; }
  catch{
    const ta = document.createElement('textarea'); ta.value = text; ta.style.position='fixed'; ta.style.opacity='0';
    document.body.appendChild(ta); ta.focus(); ta.select();
    let ok=false; try{ ok=document.execCommand('copy'); }catch{}
    document.body.removeChild(ta); return !!ok;
  }
}
btnPrepare?.addEventListener('click', async ()=>{
  if(!isLogged()){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô'); return; }
  if(!window.invoiceId || window.invoiceId === '-'){ alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏¥‡∏•'); return; }
  const msg = buildMessage();
  if (msgPreview){ msgPreview.value = msg; msgPreview.style.display = 'block'; }
  if (copyHint){ copyHint.style.display = 'block'; copyHint.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏•...'; }
  const copied = await copyTextSafe(msg);
  if (copyHint){
    copyHint.textContent = copied
      ? '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏•‡πÅ‡∏•‡πâ‡∏ß ‚úÖ ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏Å‡∏î "‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô" ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢'
      : '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏Å‡∏î "‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô"';
  }
  btnOpenAdmin.href = makeAdminUrl();
  btnOpenAdmin.style.pointerEvents = 'auto';
  btnOpenAdmin.style.opacity = '1';

  if(window.invoiceId){ updateOrderStatus(window.invoiceId, '‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡πâ‡∏ß'); }
});
btnOpenAdmin?.addEventListener('click', (e)=>{
  if (!btnOpenAdmin.href || btnOpenAdmin.getAttribute('href') === '#'){
    e.preventDefault(); window.open(makeAdminUrl(), '_blank');
  }
});

/* ===== FORM ACTIONS ===== */
document.getElementById('btnReset')?.addEventListener('click', ()=>{
  document.querySelectorAll('#order input').forEach(i=>i.value="");
  selPackage.selectedIndex = 0; updateSummary();
});
window.invoiceId = "-";
document.getElementById('btnSubmit')?.addEventListener('click', ()=>{
  if(!isLogged()){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô'); return; }
  if(!selPackage.value){ alert('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à‡∏Å‡πà‡∏≠‡∏ô'); return; }
  window.invoiceId = genInvoice();
  document.getElementById('sum-bill').innerText = window.invoiceId;
  const pay = document.getElementById('pay'); pay.style.display = ""; pay.scrollIntoView({behavior:'smooth'});

  const row = {
    ts: Date.now(),
    invoiceId: window.invoiceId,
    game: selGame.value,
    server: selServer.value,
    package: selPackage.value,
    total: document.getElementById('sum-total').innerText,
    method: document.getElementById('method').value,
    uid: document.getElementById('uid').value.trim(),
    name: document.getElementById('name').value.trim(),
    contact: document.getElementById('contact').value.trim(),
    status: '‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞'
  };
  addOrder(row);
});
document.getElementById('btnBackToForm')?.addEventListener('click', ()=>{
  document.getElementById('pay').style.display = "none";
  document.getElementById('order').scrollIntoView({behavior:'smooth'});
});

/* ===== EXPORT / CLEAR ===== */
document.getElementById('btnExportCsv')?.addEventListener('click', ()=>{
  const list = loadOrders();
  if(!list.length){ alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'); return; }
  const header = ["‡πÄ‡∏ß‡∏•‡∏≤","‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•","‡πÄ‡∏Å‡∏°","‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü","‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à","‡∏¢‡∏≠‡∏î","‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞","UID","‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤","‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠"].join(",");
  const rows = list.map(x=>[
    new Date(x.ts).toLocaleString().replaceAll(","," "),
    x.invoiceId, x.game, x.server||"-", x.package||"-",
    (x.total||"‡∏ø0").replaceAll(",",""),
    x.status, x.uid||"-", x.name||"-", x.contact||"-"
  ].map(v=>`"${String(v).replaceAll('"','""')}"`).join(","));
  const csv = [header, ...rows].join("\n");
  const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'evan_orders.csv'; a.click();
  URL.revokeObjectURL(url);
});
document.getElementById('btnClearAll')?.addEventListener('click', clearAll);

/* ===== PROFILE SAVE/FILL ===== */
function fillFromProfile(){
  const ub = userBox(); if(!ub) return;
  if(ub.name)    document.getElementById('name').value = ub.name;
  if(ub.contact) document.getElementById('contact').value = ub.contact;
  if(ub.last){
    if(ub.last.game && GAMES.find(g=>g.key===ub.last.game)){ setGame(ub.last.game); }
    if(ub.last.server){ selServer.value = ub.last.server; }
    if(ub.last.package){ selPackage.value = ub.last.package; }
    if(ub.last.method){ document.getElementById('method').value = ub.last.method; }
    if(ub.last.uid){ document.getElementById('uid').value = ub.last.uid; }
  }
  updateSummary();
}
document.getElementById('btnSaveProfile')?.addEventListener('click', ()=>{
  if(!isLogged()){ alert('‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô'); return; }
  const ub = userBox(); if(!ub){ alert('‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Å‡πà‡∏≠‡∏ô'); return; }
  ub.name = document.getElementById('name').value.trim();
  ub.contact = document.getElementById('contact').value.trim();
  ub.last = {
    game: selGame.value, server: selServer.value, package: selPackage.value,
    method: document.getElementById('method').value, uid: document.getElementById('uid').value.trim()
  };
  setUserBox(ub);
  alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß ‚úÖ');
});

/* ===== AUTH FLOW ===== */
function renderAuth(){
  const ub = userBox(); const hasUser = !!ub;
  document.getElementById('authTitle').textContent = hasUser? 'üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö' : 'üîí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å';
  document.getElementById('authDesc').textContent = hasUser? '‡πÉ‡∏™‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞ PIN ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‡∏ï‡∏±‡πâ‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ + PIN ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)';
  document.getElementById('setupForm').style.display = hasUser? 'none' : 'block';
  document.getElementById('loginForm').style.display = hasUser? 'block' : 'none';
}
async function tryAutoLogin(){
  if(isLogged()){
    showAuth(false); toggleProtected(false);
    fillFromProfile(); initHistoryFilters(); renderHistory();
    return;
  }
  renderAuth(); showAuth(true); toggleProtected(true);
}
document.getElementById('btnSetup').addEventListener('click', async ()=>{
  const user = document.getElementById('setupUser').value.trim();
  const p1 = document.getElementById('setupPin').value.trim();
  const p2 = document.getElementById('setupPin2').value.trim();
  if(!user || p1.length<4 || p1!==p2){ alert('‡∏ï‡∏£‡∏ß‡∏à‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡πÅ‡∏•‡∏∞ PIN (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏´‡∏•‡∏±‡∏Å ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô)'); return; }
  const name = document.getElementById('setupName').value.trim();
  const contact = document.getElementById('setupContact').value.trim();
  const pinHash = await hashSafe(user+'|'+p1);
  setUserBox({user, pinHash, name, contact, last: null});
  setSession(true);
  showAuth(false); toggleProtected(false);
  fillFromProfile(); initHistoryFilters(); renderHistory();
});
document.getElementById('btnLogin').addEventListener('click', async ()=>{
  const user = document.getElementById('loginUser').value.trim();
  const pin = document.getElementById('loginPin').value.trim();
  const ub = userBox(); if(!ub){ alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Å‡πà‡∏≠‡∏ô'); return; }
  const hash = await hashSafe(user+'|'+pin);
  if(hash===ub.pinHash){
    setSession(true);
    showAuth(false); toggleProtected(false);
    fillFromProfile(); initHistoryFilters(); renderHistory();
  } else {
    alert('‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠ PIN ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
  }
});
document.getElementById('btnForgot').addEventListener('click', ()=>{
  alert('‡∏•‡∏∑‡∏° PIN: ‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° ‚Äú‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‚Äù (‡∏´‡∏ô‡πâ‡∏≤ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏´‡∏°‡πà');
});
document.getElementById('btnLogout').addEventListener('click', ()=>{
  setSession(false); showAuth(true); toggleProtected(true);
});

/* ===== MARK AS PAID (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Å‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏≠‡∏á) ===== */
const slipInput = document.getElementById('slip');
const refInput  = document.getElementById('ref');
const btnMarkPaid = document.getElementById('btnMarkPaid');

function canMarkPaid(){
  const hasSlip = slipInput && slipInput.files && slipInput.files.length > 0;
  const hasRef  = (refInput?.value || '').trim().length > 0;
  return !!window.invoiceId && window.invoiceId !== '-' && (hasSlip || hasRef);
}
function updateMarkPaidState(){
  if(btnMarkPaid) btnMarkPaid.disabled = !canMarkPaid();
}
slipInput?.addEventListener('change', updateMarkPaidState);
refInput?.addEventListener('input', updateMarkPaidState);
btnMarkPaid?.addEventListener('click', ()=>{
  if(!window.invoiceId || window.invoiceId==='-'){ alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•'); return; }
  if(!canMarkPaid()){ alert('‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏Å‡πà‡∏≠‡∏ô'); return; }
  updateOrderStatus(window.invoiceId, '‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß');
  alert('‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß ‚úÖ ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î');
});

/* ===== COUNTDOWN (New Year 2026, Asia/Bangkok) ===== */
const cdDigits = document.getElementById('countdownDigits');
const ribbonTxt = document.getElementById('ribbonTxt');
function fmt2(n){ return n.toString().padStart(2,'0'); }
(function runCountdown(){
  // ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: 1 ‡∏°.‡∏Ñ. 2026 00:00:00 (+07:00)
  const target = new Date('2026-01-01T00:00:00+07:00').getTime();
  function tick(){
    const now = Date.now();
    let diff = target - now;
    if(diff <= 0){
      cdDigits.textContent = '00 ‡∏ß‡∏±‡∏ô 00:00:00';
      ribbonTxt.textContent = 'üéâ HAPPY NEW YEAR 2026';
      ribbonTxt.style.boxShadow = '0 0 20px #ffd166aa, 0 0 40px #36c06baa';
      return;
    }
    const d = Math.floor(diff / 86400000); diff %= 86400000;
    const h = Math.floor(diff / 3600000);  diff %= 3600000;
    const m = Math.floor(diff / 60000);    diff %= 60000;
    const s = Math.floor(diff / 1000);
    cdDigits.textContent = `${fmt2(d)} ‡∏ß‡∏±‡∏ô ${fmt2(h)}:${fmt2(m)}:${fmt2(s)}`;
    setTimeout(tick, 200);
  }
  tick();
})();

/* ===== INIT ===== */
renderGameTabs(); setGame(currentGame); updateSummary(); initHistoryFilters(); tryAutoLogin();
</script>
</body>
</html>
